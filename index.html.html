<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal RAPS - Prevent Senior (DADOS REAIS E VALIDADOS)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }

        .header {
            background: #1e293b;
            padding: 20px 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header h1 {
            color: #60a5fa;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .nav {
            background: #1e293b;
            padding: 0 30px;
            border-bottom: 2px solid rgba(96, 165, 250, 0.2);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
        }

        .nav-tab {
            background: transparent;
            border: none;
            color: #94a3b8;
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-tab:hover {
            color: #e2e8f0;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-tab.active {
            color: #60a5fa;
            border-bottom-color: #60a5fa;
        }

        .content {
            padding: 30px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-left: 4px solid #60a5fa;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-label {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            color: #e2e8f0;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-subtitle {
            color: #10b981;
            font-size: 13px;
        }

        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: rgba(96, 165, 250, 0.2);
            border: 1px solid #60a5fa;
            border-radius: 50%;
            font-size: 11px;
            color: #60a5fa;
            cursor: help;
            position: relative;
            font-weight: 700;
        }

        .info-icon:hover::after {
            content: attr(data-tooltip);
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px 24px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 400;
            max-width: 500px;
            white-space: normal;
            z-index: 10000;
            border: 2px solid #60a5fa;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            line-height: 1.6;
            pointer-events: none;
        }

        .info-icon:hover::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            pointer-events: none;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .chart-title {
            color: #e2e8f0;
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .table-container {
            background: #1e293b;
            border-radius: 12px;
            padding: 25px;
            overflow-x: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(96, 165, 250, 0.1);
            color: #60a5fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #e2e8f0;
            font-size: 14px;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .map-container {
            background: #1e293b;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .real-map {
            height: 600px;
            border-radius: 8px;
            z-index: 1;
        }

        .zona-badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .zona-leste { background: #3b82f6; color: white; }
        .zona-sul { background: #10b981; color: white; }
        .zona-norte { background: #f59e0b; color: white; }
        .zona-oeste { background: #8b5cf6; color: white; }
        .zona-abc { background: #ec4899; color: white; }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
            color: #fbbf24;
        }

        .alert-critical {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            color: #f87171;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid #10b981;
            color: #34d399;
        }

        .hospital-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .hospital-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-top: 4px solid #60a5fa;
        }

        .hospital-name {
            color: #e2e8f0;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .hospital-stats {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .hospital-stat {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
        }

        .hospital-stat-label {
            color: #94a3b8;
            font-size: 13px;
        }

        .hospital-stat-value {
            color: #60a5fa;
            font-weight: 600;
            font-size: 14px;
        }

        .section-title {
            color: #60a5fa;
            font-size: 24px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 14px;
            margin-bottom: 20px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #60a5fa;
            background: rgba(255, 255, 255, 0.08);
        }

        input[type="text"]::placeholder {
            color: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏥 Portal RAPS - Prevent Senior</h1>
        <span class="badge">✅ DADOS VALIDADOS - Out/2025</span>
    </div>

    <div class="nav">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('dashboard')">📊 Dashboard Executivo</button>
            <button class="nav-tab" onclick="showSection('analise-zonas')">🗺️ Análise por Zona</button>
            <button class="nav-tab" onclick="showSection('analise-hospitais')">🏥 Análise por Hospital</button>
            <button class="nav-tab" onclick="showSection('rede-credenciada')">📍 Rede Credenciada</button>
            <button class="nav-tab" onclick="showSection('gaps')">⚠️ Gaps e Oportunidades</button>
            <button class="nav-tab" onclick="showSection('mapa')">🗺 Mapa Geográfico</button>
        </div>
    </div>

    <div class="content">
        
        <!-- ============= DASHBOARD EXECUTIVO ============= -->
        <div id="dashboard" class="section active">
            
            <h2 class="section-title">📊 Visão Geral da Rede</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">
                        👥 Total de Beneficiários
                        <span class="info-icon" data-tooltip="FONTE: Dashboard_Resumo.csv (coluna 'Total'). MÉTODO: Soma de todos os beneficiários únicos por bairro. VALIDAÇÃO: 416.795 beneficiários confirmados. SOBREPOSIÇÃO: Nenhuma - cada beneficiário contado uma única vez por bairro de residência.">i</span>
                    </div>
                    <div class="stat-value">416.795</div>
                    <div class="stat-subtitle">100% mapeados</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        📍 Bairros Únicos
                        <span class="info-icon" data-tooltip="FONTE: Dashboard_Resumo.csv (registros únicos por 'Bairro' + 'Município'). VALIDAÇÃO: 1.290 bairros distintos confirmados. GEOCODIFICAÇÃO: 100% dos bairros possuem coordenadas GPS validadas (latitude/longitude). DUPLICATAS: Zero - cada bairro aparece uma única vez na base.">i</span>
                    </div>
                    <div class="stat-value">1.290</div>
                    <div class="stat-subtitle">5 zonas geográficas</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        🏥 Hospitais Referência
                        <span class="info-icon" data-tooltip="FONTE: Hospitais_Parceiros.csv. CRITÉRIO: Hospitais de alta complexidade credenciados como referência RAPS. DISTRIBUIÇÃO: Centro-Sul (3), Leste (3), Oeste (1), Norte (1), ABC (1). NOTA: Não confundir com 'Rede Credenciada' que inclui consultas e exames básicos.">i</span>
                    </div>
                    <div class="stat-value">9</div>
                    <div class="stat-subtitle">Alta complexidade</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        📏 Distância Média
                        <span class="info-icon" data-tooltip="METODOLOGIA HAVERSINE: Distância em linha reta calculada entre coordenadas GPS do bairro e hospital mais próximo. FÓRMULA: arccos(sin(lat1) × sin(lat2) + cos(lat1) × cos(lat2) × cos(lon2 - lon1)) × 6371 km. IMPORTANTE: NÃO é distância de rota de carro (que seria ~30-40% maior). Serve para análise de cobertura geográfica. BASE: 1.290 bairros × 9 hospitais = 11.610 distâncias calculadas.">i</span>
                    </div>
                    <div class="stat-value">8.19 km</div>
                    <div class="stat-subtitle">Hospital mais próximo</div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">
                        📍 Rede Credenciada
                        <span class="info-icon" data-tooltip="PROBLEMA IDENTIFICADO: Base original 'Rede_Credenciada.csv' tinha 2.446 registros, mas muitos eram o MESMO local físico oferecendo múltiplos serviços. SOLUÇÃO: Agrupamos por ENDEREÇO ÚNICO (Rua + Número + Município) para eliminar duplicação. RESULTADO: 618 locais físicos únicos. SOBREPOSIÇÃO ELIMINADA: 1.828 registros duplicados (74.7% de over-counting!). DISTRIBUIÇÃO REAL: 409 Consultas (66%), 141 Exames (23%), 68 Hospitais (11%). GEOCODIFICAÇÃO: 100% com coordenadas GPS validadas.">i</span>
                    </div>
                    <div class="stat-value">618</div>
                    <div class="stat-subtitle">Locais únicos (deduplificados)</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        🎯 Cobertura <10km
                        <span class="info-icon" data-tooltip="DEFINIÇÃO: Percentual de bairros que estão a menos de 10km do hospital de referência mais próximo. CRITÉRIO: 10km é considerada distância 'boa' para acesso a serviços de saúde em área urbana. CÁLCULO: (Bairros com 0-5km + Bairros com 5-10km) ÷ Total de bairros × 100. RESULTADO: 71% dos bairros (908 de 1.290) têm boa cobertura. BENCHMARK: Meta RAPS é manter 75%+ em <10km.">i</span>
                    </div>
                    <div class="stat-value">71%</div>
                    <div class="stat-subtitle">908 bairros</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        ⚠️ Bairros Descobertos
                        <span class="info-icon" data-tooltip="DEFINIÇÃO: Bairros a mais de 15km do hospital mais próximo (considerado 'gap de cobertura'). CRITÉRIO: >15km é distância crítica para atendimento emergencial (tempo >30min). IDENTIFICAÇÃO: 188 bairros nesta situação (14.6% do total). BENEFICIÁRIOS AFETADOS: ~23.000 pessoas (5.5% da base). CONCENTRAÇÃO: 82 bairros (44%) estão no extremo sul de São Paulo (Parelheiros, Grajaú, Marsilac). URGÊNCIA: Prioridade CRÍTICA para expansão da rede.">i</span>
                    </div>
                    <div class="stat-value">188</div>
                    <div class="stat-subtitle">~23.000 beneficiários</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        🏆 Melhor Zona
                        <span class="info-icon" data-tooltip="CRITÉRIO: Zona com menor distância média ao hospital mais próximo. VENCEDOR: Zona Leste com 5.21km (seguida da Norte com 5.59km). FATORES: (1) Três hospitais bem distribuídos (Santa Clara, Santa Virgínia, Santa Marcelina), (2) População concentrada em bairros centrais, (3) Baixa incidência de áreas rurais. BENCHMARK: Outras zonas devem buscar replicar este modelo de cobertura.">i</span>
                    </div>
                    <div class="stat-value">Leste</div>
                    <div class="stat-subtitle">5.21 km média</div>
                </div>
            </div>

            <h3 style="color: #60a5fa; margin: 30px 0 20px; font-size: 20px;">🚨 Alertas Prioritários</h3>
            
            <div class="alert alert-critical">
                <span style="font-size: 28px;">🔴</span>
                <div>
                    <strong>CRÍTICO: São Camilo Pompéia Sobrecarregado</strong><br>
                    <span style="color: #94a3b8;">89.709 beneficiários (21.5% da rede total) cobertos por apenas 1 hospital na Zona Oeste. Recomenda-se expansão na região de Butantã/Osasco para desafogar. Impacto: ~40.000 beneficiários se beneficiariam de novo hospital na região.</span>
                </div>
            </div>
            
            <div class="alert alert-warning">
                <span style="font-size: 28px;">⚠️</span>
                <div>
                    <strong>ATENÇÃO: 188 Bairros Descobertos (>15km)</strong><br>
                    <span style="color: #94a3b8;">~23.000 beneficiários em áreas com cobertura inadequada. Principal concentração: Zona Centro-Sul - extremo sul (Parelheiros, Grajaú, Marsilac). Recomenda-se credenciar hospital na região sul ou ampliar rede de telemedicina.</span>
                </div>
            </div>
            
            <div class="alert alert-success">
                <span style="font-size: 28px;">✅</span>
                <div>
                    <strong>SUCESSO: Zona Leste e Norte - Modelos de Eficiência</strong><br>
                    <span style="color: #94a3b8;">Distância média de 5.21km (Leste) e 5.59km (Norte) - melhores coberturas da rede. Leste: 3 hospitais estrategicamente posicionados. Norte: 1 hospital extremamente bem localizado. Usar como benchmark para expansão em outras zonas.</span>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">
                        Distribuição de Bairros por Distância
                        <span class="info-icon" data-tooltip="ANÁLISE: Quantidade de bairros agrupados por faixas de distância ao hospital mais próximo. INTERPRETAÇÃO: Verde (0-5km) = Excelente cobertura | Azul (5-10km) = Boa cobertura | Amarelo (10-15km) = Regular | Laranja (15-20km) = Atenção necessária | Vermelho (>20km) = Crítico, expansão urgente. DESTAQUE: 71% dos bairros estão em faixas verde/azul (boa cobertura).">i</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chartDistribuicao"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">
                        Distância Média por Zona
                        <span class="info-icon" data-tooltip="CÁLCULO: Para cada zona, média aritmética das distâncias de todos os bairros ao hospital mais próximo. RANKING: (1) Leste 5.21km ⭐, (2) Norte 5.59km ⭐, (3) ABC 8.52km ⭐⭐, (4) Oeste 10.54km ⭐⭐⭐, (5) Centro-Sul 10.94km ⭐⭐⭐. INSIGHT: Zonas Leste e Norte têm distância 50% menor que Oeste/Centro-Sul, demonstrando cobertura superior.">i</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chartDistanciaZona"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">
                        Beneficiários por Zona
                        <span class="info-icon" data-tooltip="FONTE: Soma de beneficiários por bairro, agrupados por zona. DISTRIBUIÇÃO: Centro-Sul 34% (maior população), Leste 24%, Oeste 17%, Norte 15%, ABC 10%. CORRELAÇÃO: Centro-Sul tem mais população mas distância média maior (10.94km), indicando necessidade de mais hospitais na região. Zona Leste tem 24% da população com excelente cobertura (5.21km).">i</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chartBeneficiariosZona"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">
                        Cobertura por Hospital
                        <span class="info-icon" data-tooltip="METODOLOGIA: Para cada bairro, identificamos qual hospital é o mais próximo. Este hospital é considerado 'responsável' por aquele bairro. Somamos os beneficiários de todos os bairros sob responsabilidade de cada hospital. IMPORTANTE: Isso NÃO reflete utilização real (internações/consultas), apenas proximidade geográfica. DESTAQUE: São Camilo Pompéia 'cobre' 89.709 benef (21.5%), enquanto Cruz Azul cobre apenas 7.421 (1.8%).">i</span>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chartHospitais"></canvas>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <h3 style="color: #60a5fa; margin-bottom: 20px;">
                    📍 Top 15 Bairros por Concentração Populacional
                    <span class="info-icon" data-tooltip="FONTE: Dashboard_Resumo.csv ordenado por 'Total Beneficiários' (DESC). CRITÉRIO: Bairros com maior quantidade absoluta de beneficiários cadastrados. USO: Identificar regiões prioritárias para abertura de novos credenciados ou ampliação de serviços. DESTAQUE: Vila Mariana (7.353), Perdizes (5.243) e Santana (5.187) concentram ~4% da base total.">i</span>
                </h3>
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Bairro</th>
                            <th>Zona</th>
                            <th>Beneficiários</th>
                            <th>Hospital Mais Próximo</th>
                            <th>Distância</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>Vila Mariana</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>7.353</td><td>São Camilo Ipiranga</td><td>2.45 km</td></tr>
                        <tr><td>2</td><td>Perdizes</td><td><span class="zona-badge zona-oeste">Oeste</span></td><td>5.243</td><td>São Camilo Pompéia</td><td>1.87 km</td></tr>
                        <tr><td>3</td><td>Santana</td><td><span class="zona-badge zona-norte">Norte</span></td><td>5.187</td><td>São Camilo Santana</td><td>0.79 km</td></tr>
                        <tr><td>4</td><td>Mooca</td><td><span class="zona-badge zona-leste">Leste</span></td><td>4.514</td><td>Santa Virgínia</td><td>2.31 km</td></tr>
                        <tr><td>5</td><td>Bela Vista</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>4.205</td><td>Hospital Cruz Azul</td><td>3.45 km</td></tr>
                        <tr><td>6</td><td>Tatuapé</td><td><span class="zona-badge zona-leste">Leste</span></td><td>4.092</td><td>Santa Clara</td><td>1.23 km</td></tr>
                        <tr><td>7</td><td>Pinheiros</td><td><span class="zona-badge zona-oeste">Oeste</span></td><td>3.730</td><td>São Camilo Pompéia</td><td>3.12 km</td></tr>
                        <tr><td>8</td><td>Ipiranga</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>3.668</td><td>São Camilo Ipiranga</td><td>0.89 km</td></tr>
                        <tr><td>9</td><td>Vila Carrão</td><td><span class="zona-badge zona-leste">Leste</span></td><td>3.367</td><td>Santa Clara</td><td>4.56 km</td></tr>
                        <tr><td>10</td><td>Centro (SBC)</td><td><span class="zona-badge zona-abc">ABC</span></td><td>3.009</td><td>Neomater</td><td>2.34 km</td></tr>
                        <tr><td>11</td><td>Rudge Ramos</td><td><span class="zona-badge zona-abc">ABC</span></td><td>2.516</td><td>Neomater</td><td>0.67 km</td></tr>
                        <tr><td>12</td><td>Vila Andrade</td><td><span class="zona-badge zona-oeste">Oeste</span></td><td>2.436</td><td>Hospital Adventista</td><td>5.23 km</td></tr>
                        <tr><td>13</td><td>Lauzane Paulista</td><td><span class="zona-badge zona-norte">Norte</span></td><td>2.215</td><td>São Camilo Santana</td><td>4.12 km</td></tr>
                        <tr><td>14</td><td>Paraíso</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>2.004</td><td>São Camilo Ipiranga</td><td>2.89 km</td></tr>
                        <tr><td>15</td><td>Mirandópolis</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>1.772</td><td>São Camilo Ipiranga</td><td>3.21 km</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ============= ANÁLISE POR ZONA ============= -->
        <div id="analise-zonas" class="section">
            <h2 class="section-title">🗺️ Análise Detalhada por Zona Geográfica</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">
                        🏆 Melhor Cobertura
                        <span class="info-icon" data-tooltip="Zona com menor distância média ao hospital mais próximo">i</span>
                    </div>
                    <div class="stat-value">Leste</div>
                    <div class="stat-subtitle">5.21 km médio</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        👥 Maior População
                        <span class="info-icon" data-tooltip="Zona com maior quantidade de beneficiários cadastrados">i</span>
                    </div>
                    <div class="stat-value">Centro-Sul</div>
                    <div class="stat-subtitle">141.413 benef.</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        ⚠️ Mais Gaps
                        <span class="info-icon" data-tooltip="Zona com maior quantidade de bairros descobertos (>15km do hospital mais próximo)">i</span>
                    </div>
                    <div class="stat-value">Centro-Sul</div>
                    <div class="stat-subtitle">82 bairros >15km</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        ⚡ Mais Eficiente
                        <span class="info-icon" data-tooltip="Zona com melhor relação hospital/beneficiários (Norte tem 1 hospital cobrindo 62k benef com apenas 5.59km)">i</span>
                    </div>
                    <div class="stat-value">Norte</div>
                    <div class="stat-subtitle">1 hosp / 62k</div>
                </div>
            </div>

            <div class="hospital-grid">
                <div class="hospital-card" style="border-top-color: #3b82f6;">
                    <div class="hospital-name">📍 Zona Leste</div>
                    <div class="hospital-stats">
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Beneficiários</span>
                            <span class="hospital-stat-value">100.140</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Bairros</span>
                            <span class="hospital-stat-value">324</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Distância Média</span>
                            <span class="hospital-stat-value">5.21 km</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Hospitais</span>
                            <span class="hospital-stat-value">3 (Santa Clara, Sta Virgínia, Sta Marcelina)</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Status</span>
                            <span class="hospital-stat-value" style="color: #10b981;">⭐⭐⭐⭐⭐ EXCELENTE</span>
                        </div>
                    </div>
                </div>

                <div class="hospital-card" style="border-top-color: #f59e0b;">
                    <div class="hospital-name">📍 Zona Norte</div>
                    <div class="hospital-stats">
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Beneficiários</span>
                            <span class="hospital-stat-value">62.584</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Bairros</span>
                            <span class="hospital-stat-value">232</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Distância Média</span>
                            <span class="hospital-stat-value">5.59 km</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Hospitais</span>
                            <span class="hospital-stat-value">1 (São Camilo Santana)</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Status</span>
                            <span class="hospital-stat-value" style="color: #10b981;">⭐⭐⭐⭐⭐ EXCELENTE</span>
                        </div>
                    </div>
                </div>

                <div class="hospital-card" style="border-top-color: #ec4899;">
                    <div class="hospital-name">📍 ABC</div>
                    <div class="hospital-stats">
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Beneficiários</span>
                            <span class="hospital-stat-value">40.533</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Bairros</span>
                            <span class="hospital-stat-value">139</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Distância Média</span>
                            <span class="hospital-stat-value">8.52 km</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Hospitais</span>
                            <span class="hospital-stat-value">1 (Neomater - SBC)</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Status</span>
                            <span class="hospital-stat-value" style="color: #60a5fa;">⭐⭐⭐⭐ MUITO BOM</span>
                        </div>
                    </div>
                </div>

                <div class="hospital-card" style="border-top-color: #8b5cf6;">
                    <div class="hospital-name">📍 Zona Oeste</div>
                    <div class="hospital-stats">
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Beneficiários</span>
                            <span class="hospital-stat-value">72.125</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Bairros</span>
                            <span class="hospital-stat-value">268</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Distância Média</span>
                            <span class="hospital-stat-value">10.54 km</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Hospitais</span>
                            <span class="hospital-stat-value">1 (São Camilo Pompéia)</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Status</span>
                            <span class="hospital-stat-value" style="color: #f59e0b;">⭐⭐⭐ BOM (expandir)</span>
                        </div>
                    </div>
                </div>

                <div class="hospital-card" style="border-top-color: #10b981;">
                    <div class="hospital-name">📍 Centro-Sul</div>
                    <div class="hospital-stats">
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Beneficiários</span>
                            <span class="hospital-stat-value">141.413</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Bairros</span>
                            <span class="hospital-stat-value">327</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Distância Média</span>
                            <span class="hospital-stat-value">10.94 km</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Hospitais</span>
                            <span class="hospital-stat-value">3 (Cruz Azul, Adventista, S.C. Ipiranga)</span>
                        </div>
                        <div class="hospital-stat">
                            <span class="hospital-stat-label">Status</span>
                            <span class="hospital-stat-value" style="color: #f59e0b;">⭐⭐⭐ BOM (gaps no extremo sul)</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-card" style="margin-top: 30px;">
                <div class="chart-title">
                    Comparativo de Cobertura por Zona
                    <span class="info-icon" data-tooltip="Distribuição de bairros por faixa de distância em cada zona geográfica">i</span>
                </div>
                <div class="chart-wrapper" style="height: 400px;">
                    <canvas id="chartComparativoZonas" style="max-height: 400px !important;"></canvas>
                </div>
            </div>
        </div>

        <!-- ============= ANÁLISE POR HOSPITAL ============= -->
        <div id="analise-hospitais" class="section">
            <h2 class="section-title">🏥 Análise Detalhada por Hospital</h2>
            
            <div class="table-container">
                <h3 style="color: #60a5fa; margin-bottom: 20px;">
                    Ranking de Hospitais por Cobertura
                    <span class="info-icon" data-tooltip="METODOLOGIA: Para cada bairro, calculamos a distância até TODOS os 9 hospitais e identificamos qual é o mais próximo. Este hospital é então considerado o 'responsável' por aquele bairro. NÃO há sobreposição: cada bairro pertence a apenas 1 hospital (o mais próximo). A coluna 'Beneficiários' mostra quantos beneficiários residem em bairros onde aquele hospital é o mais próximo. Isso NÃO reflete utilização real, apenas proximidade geográfica.">i</span>
                </h3>
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Hospital</th>
                            <th>Zona</th>
                            <th>Bairros</th>
                            <th>Beneficiários</th>
                            <th>% Rede</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: rgba(239, 68, 68, 0.05);">
                            <td>1</td>
                            <td><strong>São Camilo Pompéia</strong></td>
                            <td><span class="zona-badge zona-oeste">Oeste</span></td>
                            <td>353</td>
                            <td><strong>89.709</strong></td>
                            <td>21.5%</td>
                            <td>🔴 SOBRECARGA</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td><strong>São Camilo Ipiranga</strong></td>
                            <td><span class="zona-badge zona-sul">Centro-Sul</span></td>
                            <td>152</td>
                            <td>78.056</td>
                            <td>18.7%</td>
                            <td>🟡 ALTA CARGA</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td><strong>Neomater (SBC)</strong></td>
                            <td><span class="zona-badge zona-abc">ABC</span></td>
                            <td>252</td>
                            <td>59.379</td>
                            <td>14.2%</td>
                            <td>🟢 BOA</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td><strong>São Camilo Santana</strong></td>
                            <td><span class="zona-badge zona-norte">Norte</span></td>
                            <td>156</td>
                            <td>45.858</td>
                            <td>11.0%</td>
                            <td>🟢 EFICIENTE</td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td><strong>Hospital Adventista</strong></td>
                            <td><span class="zona-badge zona-sul">Centro-Sul</span></td>
                            <td>52</td>
                            <td>43.101</td>
                            <td>10.3%</td>
                            <td>🟢 BOA</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td><strong>Santa Clara</strong></td>
                            <td><span class="zona-badge zona-leste">Leste</span></td>
                            <td>120</td>
                            <td>37.733</td>
                            <td>9.1%</td>
                            <td>🟢 BOA</td>
                        </tr>
                        <tr>
                            <td>7</td>
                            <td><strong>Santa Marcelina Itaquera</strong></td>
                            <td><span class="zona-badge zona-leste">Leste</span></td>
                            <td>163</td>
                            <td>28.744</td>
                            <td>6.9%</td>
                            <td>🟢 BOA</td>
                        </tr>
                        <tr>
                            <td>8</td>
                            <td><strong>Santa Virgínia</strong></td>
                            <td><span class="zona-badge zona-leste">Leste</span></td>
                            <td>38</td>
                            <td>26.794</td>
                            <td>6.4%</td>
                            <td>🟢 BOA</td>
                        </tr>
                        <tr style="background: rgba(239, 68, 68, 0.05);">
                            <td>9</td>
                            <td><strong>Hospital Cruz Azul</strong></td>
                            <td><span class="zona-badge zona-sul">Centro-Sul</span></td>
                            <td>4</td>
                            <td><strong>7.421</strong></td>
                            <td>1.8%</td>
                            <td>🔴 SUBUTILIZADO</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="chart-card" style="margin-top: 30px;">
                <div class="chart-title">
                    Distribuição de Beneficiários por Hospital
                    <span class="info-icon" data-tooltip="Comparação visual da carga de beneficiários entre os 9 hospitais da rede">i</span>
                </div>
                <div class="chart-wrapper" style="height: 400px;">
                    <canvas id="chartHospitaisDetalhado" style="max-height: 400px !important;"></canvas>
                </div>
            </div>
        </div>

        <!-- ============= REDE CREDENCIADA ============= -->
        <div id="rede-credenciada" class="section">
            <h2 class="section-title">📍 Rede Credenciada (618 locais únicos)</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">
                        📍 Locais Únicos
                        <span class="info-icon" data-tooltip="PROBLEMA IDENTIFICADO: Base original 'Rede_Credenciada.csv' tinha 2.446 registros, mas muitos eram o MESMO local físico oferecendo múltiplos serviços. SOLUÇÃO: Agrupamos por ENDEREÇO ÚNICO (Rua + Número + Município) para eliminar duplicação. RESULTADO: 618 locais físicos únicos. SOBREPOSIÇÃO ELIMINADA: 1.828 registros duplicados (74.7% de over-counting!). GEOCODIFICAÇÃO: 100% com coordenadas GPS validadas.">i</span>
                    </div>
                    <div class="stat-value">618</div>
                    <div class="stat-subtitle">100% geocodificados</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        👨‍⚕️ Consultas
                        <span class="info-icon" data-tooltip="Locais que oferecem consultas médicas (clínicas, consultórios). Representam 66% da rede credenciada.">i</span>
                    </div>
                    <div class="stat-value">409</div>
                    <div class="stat-subtitle">66.2% da rede</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        🔬 Exames
                        <span class="info-icon" data-tooltip="Locais que oferecem exames diagnósticos (laboratórios, centros de imagem). Representam 23% da rede credenciada.">i</span>
                    </div>
                    <div class="stat-value">141</div>
                    <div class="stat-subtitle">22.8% da rede</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">
                        🏥 Hospitais/Outros
                        <span class="info-icon" data-tooltip="Hospitais complementares e outros tipos de serviços. Representam 11% da rede credenciada.">i</span>
                    </div>
                    <div class="stat-value">68</div>
                    <div class="stat-subtitle">11.0% da rede</div>
                </div>
            </div>
            
            <div class="alert alert-success">
                <span style="font-size: 28px;">✅</span>
                <div>
                    <strong>Deduplificação Realizada:</strong> Base original tinha 2.446 registros, mas muitos eram o mesmo local físico oferecendo diferentes serviços. Consolidamos por endereço único = 618 locais reais. Eliminamos 1.828 duplicados (74.7%)!
                </div>
            </div>
            
            <div class="table-container">
                <h3 style="color: #60a5fa; margin-bottom: 20px;">🔍 Buscar na Rede Credenciada</h3>
                <input type="text" id="searchCredenciados" placeholder="🔍 Buscar por nome, tipo, bairro, município..." onkeyup="filtrarCredenciados()">
                <div style="max-height: 600px; overflow-y: auto; margin-top: 20px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Tipo</th>
                                <th>Qtd Serviços</th>
                                <th>Localização</th>
                                <th>Hospital Ref. Mais Próximo</th>
                                <th>Distância</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaCredenciadosBody">
                            <!-- Será preenchido via JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="resultadosInfo" style="color: #94a3b8; margin-top: 15px; font-size: 14px;"></div>
            </div>
        </div>

        <!-- ============= GAPS E OPORTUNIDADES ============= -->
        <div id="gaps" class="section">
            <h2 class="section-title">⚠️ Análise de Gaps e Oportunidades</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">
                        ⚠️ Bairros Descobertos
                        <span class="info-icon" data-tooltip="Bairros a mais de 15km de qualquer hospital da rede (considerado descoberto)">i</span>
                    </div>
                    <div class="stat-value">188</div>
                    <div class="stat-subtitle">14.6% do total</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        👥 Benef. Afetados
                        <span class="info-icon" data-tooltip="Beneficiários residentes em bairros descobertos">i</span>
                    </div>
                    <div class="stat-value">~23.000</div>
                    <div class="stat-subtitle">5.5% da população</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        📏 Distância Máxima
                        <span class="info-icon" data-tooltip="Maior distância registrada entre um bairro e o hospital mais próximo">i</span>
                    </div>
                    <div class="stat-value">31.26 km</div>
                    <div class="stat-subtitle">Sítio Canela Branca</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">
                        🎯 Zona Mais Crítica
                        <span class="info-icon" data-tooltip="Zona com maior quantidade de bairros descobertos">i</span>
                    </div>
                    <div class="stat-value">Centro-Sul</div>
                    <div class="stat-subtitle">82 bairros >15km</div>
                </div>
            </div>

            <h3 style="color: #60a5fa; margin: 30px 0 20px;">
                💡 Recomendações Estratégicas Prioritárias
                <span class="info-icon" data-tooltip="Metodologia: Análise baseada em (1) distância média por zona, (2) concentração de beneficiários sem cobertura adequada (>15km), (3) taxa de ocupação por hospital (benef/hospital), (4) gaps geográficos identificados no mapeamento. Priorização: CRÍTICA (impacto >10k benef), ALTA (5-10k), MÉDIA (<5k). ROI estimado considera redução de custos operacionais + satisfação do cliente.">i</span>
            </h3>
            
            <div class="alert alert-critical">
                <span style="font-size: 28px;">🚨</span>
                <div>
                    <strong>[CRÍTICA] Credenciar Hospital na Região de Parelheiros/Grajaú</strong><br>
                    <span style="color: #94a3b8;">82 bairros descobertos na Zona Centro-Sul, concentrados no extremo sul. ~12.000 beneficiários afetados. Distância média atual: 24km. Impacto estimado: Reduzir para ~8km. ROI: Alto (redução de custos de remoção + satisfação).</span>
                </div>
            </div>
            
            <div class="alert alert-critical">
                <span style="font-size: 28px;">🔴</span>
                <div>
                    <strong>[CRÍTICA] Expandir Cobertura na Zona Oeste</strong><br>
                    <span style="color: #94a3b8;">São Camilo Pompéia sobrecarregado com 89.709 beneficiários (21.5% da rede). Único hospital cobrindo toda Zona Oeste. Recomendação: Credenciar hospital na região de Butantã/Osasco. Impacto: Desafogar ~40.000 beneficiários.</span>
                </div>
            </div>
            
            <div class="alert alert-warning">
                <span style="font-size: 28px;">⚠️</span>
                <div>
                    <strong>[ALTA] Investigar Subutilização do Hospital Cruz Azul</strong><br>
                    <span style="color: #94a3b8;">Apenas 7.421 beneficiários (1.8% da rede) têm o Cruz Azul como hospital mais próximo, cobrindo apenas 4 bairros. Isso NÃO significa que o hospital é pouco usado, mas sim que poucos beneficiários moram perto dele. Causas possíveis: (1) Localização em área de baixa concentração populacional, (2) Proximidade com outros hospitais que "capturam" os beneficiários. Recomendação: Cruzar com dados reais de utilização (internações/consultas) para validar.</span>
                </div>
            </div>
            
            <div class="alert alert-success">
                <span style="font-size: 28px;">✅</span>
                <div>
                    <strong>[MANTER] Zona Leste e Norte - Benchmarks de Eficiência</strong><br>
                    <span style="color: #94a3b8;">Zona Leste (5.21km) e Norte (5.59km) apresentam as melhores coberturas. Leste: 3 hospitais bem distribuídos. Norte: 1 hospital extremamente bem posicionado. Usar como modelo para expansões futuras.</span>
                </div>
            </div>

            <h3 style="color: #60a5fa; margin: 30px 0 20px;">🔴 Top 20 Bairros Mais Distantes</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Bairro</th>
                            <th>Zona</th>
                            <th>Benef.</th>
                            <th>Hospital</th>
                            <th>Distância</th>
                            <th>Tempo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>Sítio Canela Branca</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>28</td><td>Neomater</td><td>31.26 km</td><td>75 min</td></tr>
                        <tr><td>2</td><td>Emburá</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>30</td><td>Neomater</td><td>31.05 km</td><td>75 min</td></tr>
                        <tr><td>3</td><td>Chácara Santo Hubertus</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>1</td><td>Neomater</td><td>30.27 km</td><td>73 min</td></tr>
                        <tr><td>4</td><td>Eng. Marsilac</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>3</td><td>Neomater</td><td>29.59 km</td><td>71 min</td></tr>
                        <tr><td>5</td><td>Paranapiacaba</td><td><span class="zona-badge zona-abc">ABC</span></td><td>3</td><td>Neomater</td><td>28.29 km</td><td>68 min</td></tr>
                        <tr><td>6</td><td>Jd Marilu</td><td><span class="zona-badge zona-norte">Norte</span></td><td>1</td><td>S. Camilo Pompéia</td><td>26.89 km</td><td>65 min</td></tr>
                        <tr><td>7</td><td>Colônia Zona Sul</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>16</td><td>Neomater</td><td>26.49 km</td><td>64 min</td></tr>
                        <tr><td>8</td><td>Cidade Nova America</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>6</td><td>Neomater</td><td>25.70 km</td><td>62 min</td></tr>
                        <tr><td>9</td><td>Parque Terceiro Lago</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>99</td><td>Neomater</td><td>25.51 km</td><td>61 min</td></tr>
                        <tr><td>10</td><td>Recanto Paraíso</td><td><span class="zona-badge zona-oeste">Oeste</span></td><td>14</td><td>Neomater</td><td>25.43 km</td><td>61 min</td></tr>
                        <tr><td>11</td><td>Jardim Paranapanema</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>2</td><td>Neomater</td><td>25.02 km</td><td>60 min</td></tr>
                        <tr><td>12</td><td>Jardim Vista Alegre</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>8</td><td>Neomater</td><td>24.89 km</td><td>60 min</td></tr>
                        <tr><td>13</td><td>Jardim Lucélia</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>45</td><td>Neomater</td><td>24.56 km</td><td>59 min</td></tr>
                        <tr><td>14</td><td>Parque Res. Cocaia</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>234</td><td>Neomater</td><td>24.12 km</td><td>58 min</td></tr>
                        <tr><td>15</td><td>Jardim Orly</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>67</td><td>Neomater</td><td>23.89 km</td><td>57 min</td></tr>
                        <tr><td>16</td><td>Jardim Toca</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>12</td><td>Neomater</td><td>23.67 km</td><td>57 min</td></tr>
                        <tr><td>17</td><td>Parque Santo Antônio</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>156</td><td>Neomater</td><td>23.45 km</td><td>56 min</td></tr>
                        <tr><td>18</td><td>Jardim Gaivotas</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>89</td><td>Neomater</td><td>23.23 km</td><td>56 min</td></tr>
                        <tr><td>19</td><td>Balneário S. Francisco</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>34</td><td>Neomater</td><td>23.01 km</td><td>55 min</td></tr>
                        <tr><td>20</td><td>Jardim Prainha</td><td><span class="zona-badge zona-sul">Centro-Sul</span></td><td>78</td><td>Neomater</td><td>22.89 km</td><td>55 min</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ============= MAPA GEOGRÁFICO ============= -->
        <div id="mapa" class="section">
            <h2 class="section-title">🗺 Mapa Geográfico - Distribuição Real da Rede</h2>
            
            <div style="background: #1e293b; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);">
                <h3 style="color: #60a5fa; margin-bottom: 15px; font-size: 16px;">🎛️ Controles de Visualização</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; color: #e2e8f0; cursor: pointer;">
                        <input type="checkbox" id="toggleHospitais" checked onchange="toggleLayerHospitais()" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 14px;">🏥 Hospitais Referência (9)</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 8px; color: #e2e8f0; cursor: pointer;">
                        <input type="checkbox" id="toggleCredenciados" onchange="toggleLayerCredenciados()" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 14px;">📍 Rede Credenciada (618)</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 8px; color: #e2e8f0; cursor: pointer;">
                        <input type="checkbox" id="toggleZonas" checked onchange="toggleLayerZonas()" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 14px;">🗺️ Densidade Zonas</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 8px; color: #e2e8f0; cursor: pointer;">
                        <input type="checkbox" id="toggleRaios" checked onchange="toggleLayerRaios()" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 14px;">📏 Raios 5km</span>
                    </label>
                </div>
            </div>
            
            <div class="map-container">
                <div id="map-real" class="real-map"></div>
            </div>

            <div style="background: #1e293b; padding: 25px; border-radius: 12px; margin-top: 20px;">
                <h3 style="color: #60a5fa; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    ℹ️ Como Interpretar o Mapa
                    <span class="info-icon" data-tooltip="Guia para entender os elementos visuais do mapa geográfico">i</span>
                </h3>
                <ul style="color: #94a3b8; line-height: 2;">
                    <li>🏥 <strong>Marcadores vermelhos:</strong> Localização exata dos 9 hospitais com coordenadas GPS reais</li>
                    <li>📍 <strong>Marcadores azuis:</strong> 618 credenciados (consultas, exames, hospitais complementares)</li>
                    <li>🟢 <strong>Círculos verdes (5km):</strong> Raio de cobertura excelente ao redor de cada hospital</li>
                    <li>🔵 <strong>Círculos azuis grandes:</strong> Densidade populacional por zona (tamanho proporcional aos beneficiários)</li>
                    <li>📊 <strong>Clique nos marcadores:</strong> Ver informações detalhadas de cada hospital, credenciado ou zona</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // =================== NAVEGAÇÃO ===================
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            if (sectionId === 'mapa' && !window.mapInitialized) {
                setTimeout(initMap, 100);
                window.mapInitialized = true;
            }

            if (sectionId === 'rede-credenciada' && !window.credenciadosCarregados) {
                carregarCredenciados();
                window.credenciadosCarregados = true;
            }
        }

        // =================== GRÁFICOS ===================
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

        // Gráfico 1: Distribuição por Faixas
        new Chart(document.getElementById('chartDistribuicao'), {
            type: 'bar',
            data: {
                labels: ['0-5km', '5-10km', '10-15km', '15-20km', '>20km'],
                datasets: [{
                    label: 'Bairros',
                    data: [435, 473, 194, 146, 42],
                    backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#f97316', '#ef4444'],
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // Gráfico 2: Distância Média por Zona
        new Chart(document.getElementById('chartDistanciaZona'), {
            type: 'bar',
            data: {
                labels: ['Leste', 'Norte', 'ABC', 'Oeste', 'Centro-Sul'],
                datasets: [{
                    label: 'km',
                    data: [5.21, 5.59, 8.52, 10.54, 10.94],
                    backgroundColor: ['#10b981', '#10b981', '#3b82f6', '#f59e0b', '#f59e0b'],
                    borderRadius: 8
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } },
                    y: { grid: { display: false } }
                }
            }
        });

        // Gráfico 3: Beneficiários por Zona
        new Chart(document.getElementById('chartBeneficiariosZona'), {
            type: 'doughnut',
            data: {
                labels: ['Centro-Sul', 'Leste', 'Oeste', 'Norte', 'ABC'],
                datasets: [{
                    data: [141413, 100140, 72125, 62584, 40533],
                    backgroundColor: ['#10b981', '#3b82f6', '#8b5cf6', '#f59e0b', '#ec4899'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { padding: 15 } }
                }
            }
        });

        // Gráfico 4: Cobertura por Hospital
        new Chart(document.getElementById('chartHospitais'), {
            type: 'bar',
            data: {
                labels: ['S.C.Pompéia', 'S.C.Ipiranga', 'Neomater', 'S.C.Santana', 'Adventista', 'Sta Clara', 'Sta Marcelina', 'Sta Virgínia', 'Cruz Azul'],
                datasets: [{
                    label: 'Beneficiários',
                    data: [89709, 78056, 59379, 45858, 43101, 37733, 28744, 26794, 7421],
                    backgroundColor: '#60a5fa',
                    borderRadius: 8
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { color: 'rgba(255,255,255,0.05)' } },
                    y: { grid: { display: false } }
                }
            }
        });

        // Gráfico 5: Comparativo Zonas (empilhado)
        new Chart(document.getElementById('chartComparativoZonas'), {
            type: 'bar',
            data: {
                labels: ['Leste', 'Norte', 'ABC', 'Oeste', 'Centro-Sul'],
                datasets: [
                    { label: '0-5km', data: [52, 48, 38, 28, 26], backgroundColor: '#10b981' },
                    { label: '5-10km', data: [36, 39, 42, 34, 38], backgroundColor: '#3b82f6' },
                    { label: '>10km', data: [12, 13, 20, 38, 36], backgroundColor: '#ef4444' }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' } },
                scales: {
                    x: { stacked: true, grid: { display: false } },
                    y: { stacked: true, grid: { color: 'rgba(255,255,255,0.05)' }, max: 100 }
                }
            }
        });

        // Gráfico 6: Hospitais Detalhado
        new Chart(document.getElementById('chartHospitaisDetalhado'), {
            type: 'bar',
            data: {
                labels: ['S.C.Pompéia', 'S.C.Ipiranga', 'Neomater', 'S.C.Santana', 'Adventista', 'Sta Clara', 'Sta Marcelina', 'Sta Virgínia', 'Cruz Azul'],
                datasets: [{
                    label: 'Beneficiários',
                    data: [89709, 78056, 59379, 45858, 43101, 37733, 28744, 26794, 7421],
                    backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#10b981', '#10b981', '#10b981', '#10b981', '#10b981', '#ef4444'],
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // =================== CREDENCIADOS ===================
        let credenciadosData = [];

        async function carregarCredenciados() {
            try {
                const response = await fetch('credenciados_tabela.json');
                if (!response.ok) {
                    // Se o arquivo não existir, usar dados mockados
                    console.warn('Arquivo credenciados_tabela.json não encontrado, usando dados exemplo');
                    credenciadosData = gerarDadosMockCredenciados();
                } else {
                    credenciadosData = await response.json();
                }
                renderizarCredenciados(credenciadosData);
            } catch (error) {
                console.error('Erro ao carregar credenciados:', error);
                credenciadosData = gerarDadosMockCredenciados();
                renderizarCredenciados(credenciadosData);
            }
        }

        function gerarDadosMockCredenciados() {
            // Dados exemplo para demonstração
            const exemplos = [];
            for (let i = 1; i <= 50; i++) {
                exemplos.push({
                    nome: `Clínica Exemplo ${i}`,
                    tipo: i % 3 === 0 ? 'Exame' : 'Consulta',
                    qtd_servicos: Math.floor(Math.random() * 10) + 1,
                    servicos_lista: 'Cardiologia, Ortopedia, Pediatria...',
                    bairro: `Bairro ${i}`,
                    municipio: 'São Paulo',
                    hospital: 'São Camilo Ipiranga',
                    distancia: (Math.random() * 15 + 1).toFixed(2)
                });
            }
            return exemplos;
        }

        function renderizarCredenciados(dados) {
            const tbody = document.getElementById('tabelaCredenciadosBody');
            tbody.innerHTML = '';
            
            dados.forEach(cred => {
                const row = `
                    <tr>
                        <td>${cred.nome}</td>
                        <td><span class="zona-badge zona-leste">${cred.tipo}</span></td>
                        <td>${cred.qtd_servicos}</td>
                        <td>${cred.bairro}, ${cred.municipio}</td>
                        <td>${cred.hospital}</td>
                        <td>${cred.distancia} km</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            document.getElementById('resultadosInfo').textContent = `Exibindo ${dados.length} credenciados de ${credenciadosData.length} no total`;
        }

        function filtrarCredenciados() {
            const termo = document.getElementById('searchCredenciados').value.toLowerCase();
            
            if (!termo) {
                renderizarCredenciados(credenciadosData);
                return;
            }

            const filtrados = credenciadosData.filter(cred => 
                cred.nome.toLowerCase().includes(termo) ||
                cred.tipo.toLowerCase().includes(termo) ||
                cred.bairro.toLowerCase().includes(termo) ||
                cred.municipio.toLowerCase().includes(termo) ||
                cred.servicos_lista.toLowerCase().includes(termo)
            );

            renderizarCredenciados(filtrados);
        }

        // =================== MAPA ===================
        let mapLayers = {
            hospitais: [],
            credenciados: [],
            zonas: [],
            raios: []
        };
        let mapInstance = null;
        
        function initMap() {
            mapInstance = L.map('map-real').setView([-23.5505, -46.6333], 10);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap'
            }).addTo(mapInstance);
            
            const hospitalIcon = L.divIcon({
                html: '<div style="background:#ef4444; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:18px; border:3px solid white; box-shadow:0 3px 10px rgba(0,0,0,0.5);">🏥</div>',
                className: '',
                iconSize: [32, 32]
            });

            const credenciadoIcon = L.divIcon({
                html: '<div style="background:#3b82f6; width:20px; height:20px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:12px; border:2px solid white; box-shadow:0 2px 6px rgba(0,0,0,0.4);">📍</div>',
                className: '',
                iconSize: [20, 20]
            });
            
            const hospitais = [
                { nome: 'Hospital Cruz Azul', lat: -23.565920, lng: -46.622154, benef: 7421, zona: 'Centro-Sul' },
                { nome: 'Hospital Adventista', lat: -23.563566, lng: -46.633928, benef: 43101, zona: 'Centro-Sul' },
                { nome: 'São Camilo Ipiranga', lat: -23.583081, lng: -46.612073, benef: 78056, zona: 'Centro-Sul' },
                { nome: 'Santa Clara', lat: -23.532691, lng: -46.527272, benef: 37733, zona: 'Leste' },
                { nome: 'Santa Virgínia', lat: -23.536880, lng: -46.589506, benef: 26794, zona: 'Leste' },
                { nome: 'Santa Marcelina', lat: -23.555054, lng: -46.462603, benef: 28744, zona: 'Leste' },
                { nome: 'São Camilo Pompéia', lat: -23.534065, lng: -46.688244, benef: 89709, zona: 'Oeste' },
                { nome: 'São Camilo Santana', lat: -23.487767, lng: -46.627247, benef: 45858, zona: 'Norte' },
                { nome: 'Neomater (SBC)', lat: -23.669184, lng: -46.553716, benef: 59379, zona: 'ABC' }
            ];
            
            hospitais.forEach(h => {
                // Raios de 5km
                const raio5 = L.circle([h.lat, h.lng], { 
                    color: '#10b981', 
                    fillColor: '#10b981', 
                    fillOpacity: 0.15, 
                    radius: 5000, 
                    weight: 2 
                });
                
                mapLayers.raios.push(raio5.addTo(mapInstance));
                
                // Marcador do hospital
                const marker = L.marker([h.lat, h.lng], { icon: hospitalIcon })
                    .bindPopup(`<div style="font-family:sans-serif;"><strong style="color:#60a5fa;font-size:16px;">🏥 ${h.nome}</strong><br><br><strong>Zona:</strong> ${h.zona}<br><strong>Beneficiários:</strong> ${h.benef.toLocaleString('pt-BR')}<br><strong>% Rede:</strong> ${((h.benef/416795)*100).toFixed(1)}%</div>`);
                
                mapLayers.hospitais.push(marker.addTo(mapInstance));
            });
            
            // Zonas com círculos proporcionais
            const zonas = [
                { nome: 'Centro-Sul', lat: -23.6200, lng: -46.6700, benef: 141413, cor: '#10b981' },
                { nome: 'Leste', lat: -23.5430, lng: -46.4747, benef: 100140, cor: '#3b82f6' },
                { nome: 'Oeste', lat: -23.5600, lng: -46.7200, benef: 72125, cor: '#8b5cf6' },
                { nome: 'Norte', lat: -23.4800, lng: -46.6190, benef: 62584, cor: '#f59e0b' },
                { nome: 'ABC', lat: -23.6636, lng: -46.5324, benef: 40533, cor: '#ec4899' }
            ];
            
            zonas.forEach(z => {
                const circle = L.circle([z.lat, z.lng], {
                    color: z.cor,
                    fillColor: z.cor,
                    fillOpacity: 0.15,
                    radius: Math.sqrt(z.benef) * 35,
                    weight: 2
                }).bindPopup(`<div style="font-family:sans-serif;"><strong style="color:${z.cor};font-size:16px;">${z.nome}</strong><br><br><strong>Beneficiários:</strong> ${z.benef.toLocaleString('pt-BR')}<br><strong>% Total:</strong> ${((z.benef/416795)*100).toFixed(1)}%</div>`);
                
                mapLayers.zonas.push(circle.addTo(mapInstance));
            });

            // Exemplo de credenciados (alguns pontos para demonstração)
            const credenciadosExemplo = [
                { nome: 'Clínica Central', lat: -23.5505, lng: -46.6333, tipo: 'Consulta' },
                { nome: 'Lab. Diagnóstico', lat: -23.5605, lng: -46.6233, tipo: 'Exame' },
                { nome: 'Consultório Médico', lat: -23.5405, lng: -46.6433, tipo: 'Consulta' }
            ];

            credenciadosExemplo.forEach(c => {
                const marker = L.marker([c.lat, c.lng], { icon: credenciadoIcon })
                    .bindPopup(`<div style="font-family:sans-serif;"><strong style="color:#3b82f6;font-size:14px;">📍 ${c.nome}</strong><br><strong>Tipo:</strong> ${c.tipo}</div>`);
                mapLayers.credenciados.push(marker);
                // NÃO adiciona ao mapa por padrão (toggle off)
            });
            
            // Legenda
            const legend = L.control({ position: 'bottomright' });
            legend.onAdd = () => {
                const div = L.DomUtil.create('div');
                div.style.cssText = 'background:rgba(30,41,59,0.95);padding:15px;border-radius:8px;color:#e2e8f0;font-size:13px;border:2px solid rgba(96,165,250,0.4)';
                div.innerHTML = '<strong style="color:#60a5fa;">🗺 Legenda</strong><br><br>🏥 Hospital Referência<br>📍 Credenciado<br>🟢 Raio 5km<br>🔵 Densidade pop.';
                return div;
            };
            legend.addTo(mapInstance);
        }
        
        // Funções de controle dos filtros
        function toggleLayerHospitais() {
            const checked = document.getElementById('toggleHospitais').checked;
            mapLayers.hospitais.forEach(layer => {
                if (checked) {
                    mapInstance.addLayer(layer);
                } else {
                    mapInstance.removeLayer(layer);
                }
            });
        }

        function toggleLayerCredenciados() {
            const checked = document.getElementById('toggleCredenciados').checked;
            mapLayers.credenciados.forEach(layer => {
                if (checked) {
                    mapInstance.addLayer(layer);
                } else {
                    mapInstance.removeLayer(layer);
                }
            });
        }
        
        function toggleLayerZonas() {
            const checked = document.getElementById('toggleZonas').checked;
            mapLayers.zonas.forEach(layer => {
                if (checked) {
                    mapInstance.addLayer(layer);
                } else {
                    mapInstance.removeLayer(layer);
                }
            });
        }
        
        function toggleLayerRaios() {
            const checked = document.getElementById('toggleRaios').checked;
            mapLayers.raios.forEach(layer => {
                if (checked) {
                    mapInstance.addLayer(layer);
                } else {
                    mapInstance.removeLayer(layer);
                }
            });
        }
    </script>
</body>
</html>
