<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal RAPS - Prevent Senior | An√°lise Completa</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }

        .header {
            background: #1e293b;
            padding: 20px 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header h1 {
            color: #60a5fa;
            font-size: 24px;
        }

        .badge {
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            gap: 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(96, 165, 250, 0.2);
            border-top-color: #60a5fa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #60a5fa;
            font-size: 18px;
            font-weight: 600;
        }

        .nav {
            background: #1e293b;
            padding: 0 30px;
            border-bottom: 2px solid rgba(96, 165, 250, 0.2);
            overflow-x: auto;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
        }

        .nav-tab {
            background: transparent;
            border: none;
            color: #94a3b8;
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-tab:hover {
            color: #e2e8f0;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-tab.active {
            color: #60a5fa;
            border-bottom-color: #60a5fa;
        }

        .content {
            padding: 30px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-left: 4px solid #60a5fa;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-label {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            color: #e2e8f0;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-subtitle {
            color: #10b981;
            font-size: 13px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .chart-title {
            color: #e2e8f0;
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .table-container {
            background: #1e293b;
            border-radius: 12px;
            padding: 25px;
            overflow-x: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(96, 165, 250, 0.1);
            color: #60a5fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            position: sticky;
            top: 0;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #e2e8f0;
            font-size: 14px;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .map-container {
            background: #1e293b;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .real-map {
            height: 600px;
            border-radius: 8px;
            z-index: 1;
        }

        .zona-badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .zona-centro { background: #6366f1; color: white; }
        .zona-centro-sul { background: #10b981; color: white; }
        .zona-leste { background: #3b82f6; color: white; }
        .zona-norte { background: #f59e0b; color: white; }
        .zona-oeste { background: #8b5cf6; color: white; }
        .zona-abc { background: #ec4899; color: white; }

        .section-title {
            color: #60a5fa;
            font-size: 24px;
            margin-bottom: 25px;
        }

        .hospital-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .hospital-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-top: 4px solid #60a5fa;
        }

        .hospital-name {
            color: #e2e8f0;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .hospital-stats {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .hospital-stat {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
        }

        .hospital-stat-label {
            color: #94a3b8;
            font-size: 13px;
        }

        .hospital-stat-value {
            color: #60a5fa;
            font-weight: 600;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Carregando Portal RAPS...</div>
    </div>

    <div class="header">
        <h1>üè• Portal RAPS - Prevent Senior</h1>
        <span class="badge">‚úÖ DADOS REAIS - Out/2025</span>
    </div>

    <div class="nav">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showSection('demografia')">üë• Demografia</button>
            <button class="nav-tab" onclick="showSection('programas')">üìã Programas</button>
            <button class="nav-tab" onclick="showSection('zonas')">üó∫Ô∏è Zonas</button>
            <button class="nav-tab" onclick="showSection('hospitais')">üè• Hospitais</button>
            <button class="nav-tab" onclick="showSection('gaps')">‚ö†Ô∏è Gaps</button>
            <button class="nav-tab" onclick="showSection('mapa')">üó∫ Mapa</button>
        </div>
    </div>

    <div class="content" id="mainContent" style="display: none;">
        
        <!-- DASHBOARD EXECUTIVO -->
        <div id="dashboard" class="section active">
            <h2 class="section-title">üìä Vis√£o Geral da Rede</h2>
            <div class="stats-grid" id="dashboardStats"></div>
            <div class="charts-grid" id="dashboardCharts"></div>
            <div class="table-container" id="topBairros"></div>
        </div>

        <!-- AN√ÅLISE DEMOGR√ÅFICA -->
        <div id="demografia" class="section">
            <h2 class="section-title">üë• An√°lise Demogr√°fica</h2>
            <div class="stats-grid" id="demografiaStats"></div>
            <div class="charts-grid" id="demografiaCharts"></div>
        </div>

        <!-- AN√ÅLISE DE PROGRAMAS -->
        <div id="programas" class="section">
            <h2 class="section-title">üìã An√°lise de Programas</h2>
            <div class="stats-grid" id="programasStats"></div>
            <div class="charts-grid" id="programasCharts"></div>
            <div class="table-container" id="programasTabela"></div>
        </div>

        <!-- AN√ÅLISE POR ZONA -->
        <div id="zonas" class="section">
            <h2 class="section-title">üó∫Ô∏è An√°lise por Zona</h2>
            <div class="hospital-grid" id="zonasCards"></div>
            <div class="charts-grid" id="zonasCharts"></div>
        </div>

        <!-- AN√ÅLISE POR HOSPITAL -->
        <div id="hospitais" class="section">
            <h2 class="section-title">üè• An√°lise por Hospital</h2>
            <div class="table-container" id="hospitaisTabela"></div>
            <div class="charts-grid" id="hospitaisCharts"></div>
        </div>

        <!-- GAPS E OPORTUNIDADES -->
        <div id="gaps" class="section">
            <h2 class="section-title">‚ö†Ô∏è Gaps e Oportunidades</h2>
            <div class="stats-grid" id="gapsStats"></div>
            <div class="table-container" id="gapsTabela"></div>
        </div>

        <!-- MAPA GEOGR√ÅFICO -->
        <div id="mapa" class="section">
            <h2 class="section-title">üó∫ Mapa Geogr√°fico</h2>
            <div class="map-container">
                <div id="mapReal" class="real-map"></div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ÉO
        const GITHUB_USER = 'alessandrodiazrodrigues';
        const REPO = 'RAPS';
        const BRANCH = 'main';
        const DATA_URL = `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/${BRANCH}`;

        // DADOS GLOBAIS
        let dados = {
            dashboard: null,
            demografico: null,
            programas: null,
            planos: null,
            zonas: null,
            hospitais: null,
            distancias: null,
            bairros: []
        };

        let mapInstance = null;
        let chartInstances = {};

        // ==========================================
        // üîç FUN√á√ÉO DE LOG DETALHADO
        // ==========================================
        function logDetalhado(titulo, objeto) {
            console.log(`\n${'='.repeat(60)}`);
            console.log(`üîç ${titulo}`);
            console.log(`${'='.repeat(60)}`);
            console.log(JSON.stringify(objeto, null, 2));
            console.log(`${'='.repeat(60)}\n`);
        }

        // ==========================================
        // CARREGAR DADOS COM LOGS EXTENSOS
        // ==========================================
        async function carregarDados() {
            try {
                console.log('üîÑ INICIANDO CARREGAMENTO DE DADOS...');
                
                const [
                    dashboard,
                    demografico,
                    programas,
                    planos,
                    zonas,
                    hospitais,
                    distancias,
                    bairrosCentro,
                    bairrosCentroSul,
                    bairrosLeste,
                    bairrosNorte,
                    bairrosOeste,
                    bairrosABC
                ] = await Promise.all([
                    fetch(`${DATA_URL}/dashboard.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/demografico.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/programas.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/planos.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/zonas.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/hospitais.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/distancias.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/bairros_centro.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/bairros_centro_sul.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/bairros_leste.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/bairros_norte.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/bairros_oeste.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/bairros_abc.json`).then(r => r.json())
                ]);

                // Armazenar dados
                dados.dashboard = dashboard;
                dados.demografico = demografico;
                dados.programas = programas;
                dados.planos = planos;
                dados.zonas = zonas;
                dados.hospitais = hospitais;
                dados.distancias = distancias;

                // MERGE dos 6 arquivos de bairros
                dados.bairros = [
                    ...bairrosCentro.bairros,
                    ...bairrosCentroSul.bairros,
                    ...bairrosLeste.bairros,
                    ...bairrosNorte.bairros,
                    ...bairrosOeste.bairros,
                    ...bairrosABC.bairros
                ];

                // ==========================================
                // üìä LOGS DETALHADOS DA ESTRUTURA DOS DADOS
                // ==========================================
                
                // 1. DASHBOARD
                logDetalhado('DASHBOARD - Estrutura Completa', {
                    metadata: dashboard.metadata,
                    kpis_gerais: dashboard.kpis_gerais,
                    distribuicao_faixas: dashboard.distribuicao_faixas,
                    top_bairros_exemplo: dashboard.top_bairros ? dashboard.top_bairros[0] : null,
                    keys_disponiveis: Object.keys(dashboard)
                });

                // 2. DEMOGRAFICO
                logDetalhado('DEMOGRAFICO - Estrutura Completa', {
                    kpis: demografico.kpis,
                    faixas_etarias: demografico.faixas_etarias,
                    perfil_80_menos_exemplo: demografico.faixas_etarias?.perfil_80_menos,
                    perfil_80_mais_exemplo: demografico.faixas_etarias?.perfil_80_mais,
                    keys_disponiveis: Object.keys(demografico)
                });

                // 3. ZONAS
                logDetalhado('ZONAS - Estrutura Completa', {
                    total_zonas: zonas.zonas?.length || 0,
                    zona_exemplo: zonas.zonas ? zonas.zonas[0] : null,
                    todas_zonas: zonas.zonas,
                    keys_disponiveis: Object.keys(zonas),
                    keys_zona_exemplo: zonas.zonas && zonas.zonas[0] ? Object.keys(zonas.zonas[0]) : []
                });

                // 4. HOSPITAIS
                logDetalhado('HOSPITAIS - Estrutura Completa', {
                    total_hospitais: hospitais.hospitais?.length || 0,
                    hospital_exemplo: hospitais.hospitais ? hospitais.hospitais[0] : null,
                    todos_hospitais: hospitais.hospitais,
                    keys_disponiveis: Object.keys(hospitais),
                    keys_hospital_exemplo: hospitais.hospitais && hospitais.hospitais[0] ? Object.keys(hospitais.hospitais[0]) : []
                });

                // 5. DISTANCIAS
                logDetalhado('DISTANCIAS - Estrutura Completa', {
                    top_20_exemplo: distancias.top_20_distantes ? distancias.top_20_distantes[0] : null,
                    distribuicao_por_faixa: distancias.distribuicao_por_faixa,
                    keys_disponiveis: Object.keys(distancias),
                    keys_top20_exemplo: distancias.top_20_distantes && distancias.top_20_distantes[0] ? Object.keys(distancias.top_20_distantes[0]) : []
                });

                // 6. PROGRAMAS
                logDetalhado('PROGRAMAS - Estrutura Completa', {
                    total_programas: programas.programas?.length || 0,
                    programa_exemplo: programas.programas ? programas.programas[0] : null,
                    top_10: programas.top_10,
                    keys_disponiveis: Object.keys(programas)
                });

                console.log('‚úÖ DADOS CARREGADOS COM SUCESSO');
                console.log(`üìä Total de bairros consolidados: ${dados.bairros.length}`);

                // Renderizar tudo
                renderizarTudo();
                
                // Esconder loading
                document.getElementById('loading').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
            } catch (error) {
                console.error('‚ùå ERRO FATAL AO CARREGAR DADOS:', error);
                console.error('Stack trace:', error.stack);
                document.querySelector('.loading-text').textContent = 'Erro ao carregar dados. Verifique o console.';
                document.querySelector('.loading-text').style.color = '#ef4444';
            }
        }

        // RENDERIZAR TUDO
        function renderizarTudo() {
            console.log('\nüé® INICIANDO RENDERIZA√á√ÉO...\n');
            renderizarDashboard();
            renderizarDemografia();
            renderizarProgramas();
            renderizarZonas();
            renderizarHospitais();
            renderizarGaps();
        }

        // ==========================================
        // DASHBOARD COM LOGS
        // ==========================================
        function renderizarDashboard() {
            console.log('üìä RENDERIZANDO DASHBOARD...');
            
            try {
                const { kpis_gerais, distribuicao_faixas, top_bairros } = dados.dashboard;
                
                console.log('Dashboard - kpis_gerais:', kpis_gerais);
                console.log('Dashboard - distribuicao_faixas:', distribuicao_faixas);
                console.log('Dashboard - top_bairros (primeiro):', top_bairros ? top_bairros[0] : null);
                
                // Stats
                document.getElementById('dashboardStats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-label">üë• Total Benefici√°rios</div>
                        <div class="stat-value">${parseInt(kpis_gerais.total_beneficiarios).toLocaleString('pt-BR')}</div>
                        <div class="stat-subtitle">100% mapeados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üìç Bairros √önicos</div>
                        <div class="stat-value">${parseInt(kpis_gerais.total_bairros).toLocaleString('pt-BR')}</div>
                        <div class="stat-subtitle">6 zonas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üè• Hospitais</div>
                        <div class="stat-value">${parseInt(kpis_gerais.total_hospitais)}</div>
                        <div class="stat-subtitle">Rede credenciada</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üìè Dist√¢ncia M√©dia</div>
                        <div class="stat-value">${parseFloat(kpis_gerais.distancia_media_km).toFixed(2)} km</div>
                        <div class="stat-subtitle">Hospital mais pr√≥ximo</div>
                    </div>
                `;

                // Charts
                document.getElementById('dashboardCharts').innerHTML = `
                    <div class="chart-card">
                        <div class="chart-title">Distribui√ß√£o por Faixas de Dist√¢ncia</div>
                        <div class="chart-wrapper"><canvas id="chartFaixas"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Benefici√°rios por Zona</div>
                        <div class="chart-wrapper"><canvas id="chartBenefZona"></canvas></div>
                    </div>
                `;

                // Gr√°fico Faixas - COM VALIDA√á√ÉO
                console.log('üìä Criando gr√°fico de faixas...');
                console.log('Dados distribuicao_faixas:', distribuicao_faixas);
                
                if (distribuicao_faixas && typeof distribuicao_faixas === 'object') {
                    const labels = Object.keys(distribuicao_faixas);
                    const values = Object.values(distribuicao_faixas).map(f => {
                        console.log('Faixa:', f);
                        return parseInt(f.bairros || 0);
                    });
                    
                    console.log('Labels para gr√°fico:', labels);
                    console.log('Valores para gr√°fico:', values);
                    
                    new Chart(document.getElementById('chartFaixas'), {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Bairros',
                                data: values,
                                backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#f97316', '#ef4444'],
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { 
                                legend: { display: false }
                            },
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    ticks: { color: '#94a3b8' },
                                    grid: { color: 'rgba(255,255,255,0.05)' }
                                },
                                x: { 
                                    ticks: { color: '#94a3b8' },
                                    grid: { display: false }
                                }
                            }
                        }
                    });
                } else {
                    console.error('‚ùå distribuicao_faixas inv√°lido:', distribuicao_faixas);
                }

                // Gr√°fico Zonas
                const zonasData = dados.zonas.zonas;
                console.log('üìä Criando gr√°fico de zonas...');
                console.log('Dados zonas:', zonasData);
                
                new Chart(document.getElementById('chartBenefZona'), {
                    type: 'doughnut',
                    data: {
                        labels: zonasData.map(z => z.zona || z.nome_zona || z.nome || 'Zona Desconhecida'),
                        datasets: [{
                            data: zonasData.map(z => parseInt(z.beneficiarios || 0)),
                            backgroundColor: ['#6366f1', '#10b981', '#3b82f6', '#f59e0b', '#8b5cf6', '#ec4899']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'bottom',
                                labels: { color: '#94a3b8' }
                            } 
                        }
                    }
                });

                // Tabela Top Bairros - COM VALIDA√á√ÉO
                console.log('üìä Criando tabela top bairros...');
                console.log('Top bairros (primeiro):', top_bairros ? top_bairros[0] : null);
                
                if (top_bairros && top_bairros.length > 0) {
                    const primeiroElem = top_bairros[0];
                    console.log('Chaves dispon√≠veis no primeiro bairro:', Object.keys(primeiroElem));
                    console.log('Campo hospital:', {
                        hospital: primeiroElem.hospital,
                        hospital_mais_proximo: primeiroElem.hospital_mais_proximo,
                        nome_hospital: primeiroElem.nome_hospital,
                        hospital_mais_proximo_nome: primeiroElem.hospital_mais_proximo_nome
                    });
                }
                
                document.getElementById('topBairros').innerHTML = `
                    <h3 style="color: #60a5fa; margin-bottom: 20px;">üìç Top 15 Bairros</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Bairro</th>
                                <th>Zona</th>
                                <th>Benefici√°rios</th>
                                <th>Hospital Mais Pr√≥ximo</th>
                                <th>Dist√¢ncia</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${top_bairros.slice(0, 15).map((b, i) => {
                                const nomeHospital = b.hospital_mais_proximo || b.hospital || b.nome_hospital || b.hospital_mais_proximo_nome || 'N/A';
                                console.log(`Bairro ${b.bairro} - Hospital: ${nomeHospital}`);
                                return `
                                    <tr>
                                        <td>${i + 1}</td>
                                        <td>${b.bairro}</td>
                                        <td><span class="zona-badge zona-${normalizeZona(b.zona)}">${b.zona}</span></td>
                                        <td>${parseInt(b.beneficiarios).toLocaleString('pt-BR')}</td>
                                        <td>${nomeHospital}</td>
                                        <td>${parseFloat(b.distancia_km || b.distancia_linha_reta_km || 0).toFixed(2)} km</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
                
                console.log('‚úÖ Dashboard renderizado com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao renderizar dashboard:', error);
                console.error('Stack:', error.stack);
            }
        }

        // ==========================================
        // DEMOGRAFIA COM LOGS
        // ==========================================
        function renderizarDemografia() {
            console.log('üë• RENDERIZANDO DEMOGRAFIA...');
            
            try {
                const { kpis, faixas_etarias } = dados.demografico;
                
                console.log('Demografia - kpis:', kpis);
                console.log('Demografia - faixas_etarias:', faixas_etarias);
                
                const idadeMedia = parseFloat(kpis.idade_media_adultos_18plus);
                const pctFem = parseFloat(kpis.pct_feminino);
                const pctMasc = parseFloat(kpis.pct_masculino);
                const totalFem = parseInt(kpis.total_feminino);
                const totalMasc = parseInt(kpis.total_masculino);
                const totalIdosos = parseInt(kpis.total_idosos_80plus);
                
                // Stats
                document.getElementById('demografiaStats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-label">üéÇ Idade M√©dia (18+)</div>
                        <div class="stat-value">${idadeMedia.toFixed(1)} anos</div>
                        <div class="stat-subtitle">Apenas adultos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üë© Feminino</div>
                        <div class="stat-value">${pctFem.toFixed(1)}%</div>
                        <div class="stat-subtitle">${totalFem.toLocaleString('pt-BR')} mulheres</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üë® Masculino</div>
                        <div class="stat-value">${pctMasc.toFixed(1)}%</div>
                        <div class="stat-subtitle">${totalMasc.toLocaleString('pt-BR')} homens</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üë¥ Idosos (‚â•80)</div>
                        <div class="stat-value">${totalIdosos.toLocaleString('pt-BR')}</div>
                        <div class="stat-subtitle">${((totalIdosos/dados.dashboard.kpis_gerais.total_beneficiarios)*100).toFixed(1)}% do total</div>
                    </div>
                `;

                // Charts
                document.getElementById('demografiaCharts').innerHTML = `
                    <div class="chart-card">
                        <div class="chart-title">Faixas Et√°rias (Perfil 80-)</div>
                        <div class="chart-wrapper"><canvas id="chartFaixas80Menos"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Faixas Et√°rias (Perfil 80+)</div>
                        <div class="chart-wrapper"><canvas id="chartFaixas80Mais"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Distribui√ß√£o por G√™nero</div>
                        <div class="chart-wrapper"><canvas id="chartGenero"></canvas></div>
                    </div>
                `;

                // Gr√°fico 80- - COM VALIDA√á√ÉO
                console.log('üìä Criando gr√°fico 80-...');
                const perfil80Menos = faixas_etarias.perfil_80_menos;
                console.log('Perfil 80-:', perfil80Menos);
                
                if (perfil80Menos && perfil80Menos.faixas) {
                    console.log('Faixas 80-:', perfil80Menos.faixas);
                    console.log('Keys faixas 80-:', Object.keys(perfil80Menos.faixas));
                    
                    const labels80Menos = Object.keys(perfil80Menos.faixas).map(k => {
                        const faixa = perfil80Menos.faixas[k];
                        return faixa.label || faixa.faixa || k;
                    });
                    const values80Menos = Object.keys(perfil80Menos.faixas).map(k => {
                        return parseInt(perfil80Menos.faixas[k].total || 0);
                    });
                    
                    console.log('Labels 80-:', labels80Menos);
                    console.log('Values 80-:', values80Menos);
                    
                    new Chart(document.getElementById('chartFaixas80Menos'), {
                        type: 'bar',
                        data: {
                            labels: labels80Menos,
                            datasets: [{
                                label: 'Benefici√°rios',
                                data: values80Menos,
                                backgroundColor: '#3b82f6',
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    ticks: { color: '#94a3b8' },
                                    grid: { color: 'rgba(255,255,255,0.05)' }
                                },
                                x: { 
                                    ticks: { color: '#94a3b8' },
                                    grid: { display: false }
                                }
                            }
                        }
                    });
                } else {
                    console.error('‚ùå Perfil 80- inv√°lido:', perfil80Menos);
                }

                // Gr√°fico 80+ - COM VALIDA√á√ÉO
                console.log('üìä Criando gr√°fico 80+...');
                const perfil80Mais = faixas_etarias.perfil_80_mais;
                console.log('Perfil 80+:', perfil80Mais);
                
                if (perfil80Mais && perfil80Mais.faixas) {
                    console.log('Faixas 80+:', perfil80Mais.faixas);
                    console.log('Keys faixas 80+:', Object.keys(perfil80Mais.faixas));
                    
                    const labels80Mais = Object.keys(perfil80Mais.faixas).map(k => {
                        const faixa = perfil80Mais.faixas[k];
                        return faixa.label || faixa.faixa || k;
                    });
                    const values80Mais = Object.keys(perfil80Mais.faixas).map(k => {
                        return parseInt(perfil80Mais.faixas[k].total || 0);
                    });
                    
                    console.log('Labels 80+:', labels80Mais);
                    console.log('Values 80+:', values80Mais);
                    
                    new Chart(document.getElementById('chartFaixas80Mais'), {
                        type: 'bar',
                        data: {
                            labels: labels80Mais,
                            datasets: [{
                                label: 'Benefici√°rios',
                                data: values80Mais,
                                backgroundColor: '#f59e0b',
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    ticks: { color: '#94a3b8' },
                                    grid: { color: 'rgba(255,255,255,0.05)' }
                                },
                                x: { 
                                    ticks: { color: '#94a3b8' },
                                    grid: { display: false }
                                }
                            }
                        }
                    });
                } else {
                    console.error('‚ùå Perfil 80+ inv√°lido:', perfil80Mais);
                }

                // Gr√°fico G√™nero
                new Chart(document.getElementById('chartGenero'), {
                    type: 'pie',
                    data: {
                        labels: [`Feminino (${pctFem.toFixed(1)}%)`, `Masculino (${pctMasc.toFixed(1)}%)`],
                        datasets: [{
                            data: [totalFem, totalMasc],
                            backgroundColor: ['#ec4899', '#3b82f6']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'bottom',
                                labels: { color: '#94a3b8' }
                            } 
                        }
                    }
                });
                
                console.log('‚úÖ Demografia renderizada com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao renderizar demografia:', error);
                console.error('Stack:', error.stack);
            }
        }

        // ==========================================
        // PROGRAMAS COM LOGS
        // ==========================================
        function renderizarProgramas() {
            console.log('üìã RENDERIZANDO PROGRAMAS...');
            
            try {
                const { programas: progs, top_10 } = dados.programas;
                const totalBenef = parseInt(dados.dashboard.kpis_gerais.total_beneficiarios);
                
                console.log('Programas - total:', progs.length);
                console.log('Programas - primeiro:', progs[0]);
                console.log('Programas - top_10:', top_10);
                
                // Filtrar "SEM PROGRAMA"
                const comPrograma = progs.find(p => p.nome === "SEM PROGRAMA");
                const semPrograma = comPrograma ? parseInt(comPrograma.total) : 0;
                const totalComPrograma = totalBenef - semPrograma;
                
                console.log('Sem programa:', semPrograma);
                console.log('Com programa:', totalComPrograma);
                
                // Stats
                document.getElementById('programasStats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-label">üìã Total Programas</div>
                        <div class="stat-value">${progs.length}</div>
                        <div class="stat-subtitle">Categorias</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">‚ùå Sem Programa</div>
                        <div class="stat-value">${semPrograma.toLocaleString('pt-BR')}</div>
                        <div class="stat-subtitle">${((semPrograma/totalBenef)*100).toFixed(1)}%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">‚úÖ Com Programa</div>
                        <div class="stat-value">${totalComPrograma.toLocaleString('pt-BR')}</div>
                        <div class="stat-subtitle">${((totalComPrograma/totalBenef)*100).toFixed(1)}%</div>
                    </div>
                `;

                // Charts - Top 10 SEM "SEM PROGRAMA"
                const top10Ativos = top_10.filter(p => p.nome !== "SEM PROGRAMA");
                console.log('Top 10 ativos:', top10Ativos);
                
                document.getElementById('programasCharts').innerHTML = `
                    <div class="chart-card" style="grid-column: 1 / -1;">
                        <div class="chart-title">Top 10 Programas ATIVOS</div>
                        <div class="chart-wrapper"><canvas id="chartTop10Programas"></canvas></div>
                    </div>
                `;

                new Chart(document.getElementById('chartTop10Programas'), {
                    type: 'bar',
                    data: {
                        labels: top10Ativos.map(p => p.nome),
                        datasets: [{
                            label: 'Benefici√°rios',
                            data: top10Ativos.map(p => parseInt(p.total)),
                            backgroundColor: '#60a5fa',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { 
                                beginAtZero: true,
                                ticks: { color: '#94a3b8' },
                                grid: { color: 'rgba(255,255,255,0.05)' }
                            },
                            y: { 
                                ticks: { color: '#94a3b8' },
                                grid: { display: false }
                            }
                        }
                    }
                });

                // Tabela - FILTRANDO "SEM PROGRAMA"
                const progsAtivos = progs.filter(p => p.nome !== "SEM PROGRAMA");
                console.log('Programas ativos para tabela:', progsAtivos.length);
                
                document.getElementById('programasTabela').innerHTML = `
                    <h3 style="color: #60a5fa; margin-bottom: 20px;">üìä Todos os Programas ATIVOS</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Programa</th>
                                <th>Benefici√°rios</th>
                                <th>% Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${progsAtivos.map((p, i) => `
                                <tr>
                                    <td>${i + 1}</td>
                                    <td>${p.nome}</td>
                                    <td>${parseInt(p.total).toLocaleString('pt-BR')}</td>
                                    <td>${parseFloat(p.percentual).toFixed(1)}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                
                console.log('‚úÖ Programas renderizados com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao renderizar programas:', error);
                console.error('Stack:', error.stack);
            }
        }

        // ==========================================
        // ZONAS COM LOGS
        // ==========================================
        function renderizarZonas() {
            console.log('üó∫Ô∏è RENDERIZANDO ZONAS...');
            
            try {
                const zonasData = dados.zonas.zonas;
                console.log('Zonas - total:', zonasData.length);
                console.log('Zonas - primeira:', zonasData[0]);
                console.log('Zonas - keys da primeira:', zonasData[0] ? Object.keys(zonasData[0]) : []);
                
                // Cards - COM VALIDA√á√ÉO
                document.getElementById('zonasCards').innerHTML = zonasData.map(z => {
                    const nomeZona = z.zona || z.nome_zona || z.nome || 'Zona Desconhecida';
                    console.log(`Processando zona: ${nomeZona}`, z);
                    
                    return `
                        <div class="hospital-card" style="border-top-color: ${getZonaColor(nomeZona)};">
                            <div class="hospital-name">üìç ${nomeZona}</div>
                            <div class="hospital-stats">
                                <div class="hospital-stat">
                                    <span class="hospital-stat-label">üë• Benefici√°rios</span>
                                    <span class="hospital-stat-value">${parseInt(z.beneficiarios || 0).toLocaleString('pt-BR')}</span>
                                </div>
                                <div class="hospital-stat">
                                    <span class="hospital-stat-label">üèòÔ∏è Bairros</span>
                                    <span class="hospital-stat-value">${parseInt(z.bairros || 0)}</span>
                                </div>
                                <div class="hospital-stat">
                                    <span class="hospital-stat-label">üéÇ Idade M√©dia (18+)</span>
                                    <span class="hospital-stat-value">${parseFloat(z.idade_media_adultos_18plus || 0).toFixed(1)} anos</span>
                                </div>
                                <div class="hospital-stat">
                                    <span class="hospital-stat-label">üë© Feminino</span>
                                    <span class="hospital-stat-value">${parseFloat(z.pct_feminino || 0).toFixed(1)}%</span>
                                </div>
                                <div class="hospital-stat">
                                    <span class="hospital-stat-label">üë® Masculino</span>
                                    <span class="hospital-stat-value">${parseFloat(z.pct_masculino || 0).toFixed(1)}%</span>
                                </div>
                                <div class="hospital-stat">
                                    <span class="hospital-stat-label">üìè Dist√¢ncia M√©dia</span>
                                    <span class="hospital-stat-value">${parseFloat(z.distancia_media_km || 0).toFixed(2)} km</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // Charts
                document.getElementById('zonasCharts').innerHTML = `
                    <div class="chart-card">
                        <div class="chart-title">Dist√¢ncia M√©dia por Zona</div>
                        <div class="chart-wrapper"><canvas id="chartDistZona"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Idade M√©dia por Zona (18+)</div>
                        <div class="chart-wrapper"><canvas id="chartIdadeZona"></canvas></div>
                    </div>
                `;

                // Gr√°fico Dist√¢ncia
                new Chart(document.getElementById('chartDistZona'), {
                    type: 'bar',
                    data: {
                        labels: zonasData.map(z => z.zona || z.nome_zona || z.nome || 'N/A'),
                        datasets: [{
                            label: 'km',
                            data: zonasData.map(z => parseFloat(z.distancia_media_km || 0)),
                            backgroundColor: zonasData.map(z => getZonaColor(z.zona || z.nome_zona || z.nome)),
                            borderRadius: 8
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { 
                                beginAtZero: true,
                                ticks: { color: '#94a3b8' },
                                grid: { color: 'rgba(255,255,255,0.05)' }
                            },
                            y: { 
                                ticks: { color: '#94a3b8' },
                                grid: { display: false }
                            }
                        }
                    }
                });

                // Gr√°fico Idade
                new Chart(document.getElementById('chartIdadeZona'), {
                    type: 'bar',
                    data: {
                        labels: zonasData.map(z => z.zona || z.nome_zona || z.nome || 'N/A'),
                        datasets: [{
                            label: 'Anos',
                            data: zonasData.map(z => parseFloat(z.idade_media_adultos_18plus || 0)),
                            backgroundColor: zonasData.map(z => getZonaColor(z.zona || z.nome_zona || z.nome)),
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { 
                                beginAtZero: true,
                                max: 80,
                                ticks: { color: '#94a3b8' },
                                grid: { color: 'rgba(255,255,255,0.05)' }
                            },
                            x: { 
                                ticks: { color: '#94a3b8' },
                                grid: { display: false }
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Zonas renderizadas com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao renderizar zonas:', error);
                console.error('Stack:', error.stack);
            }
        }

        // ==========================================
        // HOSPITAIS COM LOGS
        // ==========================================
        function renderizarHospitais() {
            console.log('üè• RENDERIZANDO HOSPITAIS...');
            
            try {
                const hospsData = dados.hospitais.hospitais;
                console.log('Hospitais - total:', hospsData.length);
                console.log('Hospitais - primeiro:', hospsData[0]);
                console.log('Hospitais - keys do primeiro:', hospsData[0] ? Object.keys(hospsData[0]) : []);
                
                // Tabela - COM VALIDA√á√ÉO
                document.getElementById('hospitaisTabela').innerHTML = `
                    <h3 style="color: #60a5fa; margin-bottom: 20px;">üè• Ranking de Hospitais</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Hospital</th>
                                <th>Zona</th>
                                <th>Bairros</th>
                                <th>Benefici√°rios</th>
                                <th>% Rede</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${hospsData.map((h, i) => {
                                const nomeHosp = h.hospital || h.nome || h.nome_hospital || 'Hospital Desconhecido';
                                console.log(`Hospital ${i+1}: ${nomeHosp}`, h);
                                return `
                                    <tr>
                                        <td>${i + 1}</td>
                                        <td><strong>${nomeHosp}</strong></td>
                                        <td><span class="zona-badge zona-${normalizeZona(h.zona || '')}">${h.zona || 'N/A'}</span></td>
                                        <td>${parseInt(h.bairros_cobertos || 0).toLocaleString('pt-BR')}</td>
                                        <td>${parseInt(h.beneficiarios || 0).toLocaleString('pt-BR')}</td>
                                        <td>${parseFloat(h.percentual_rede || 0).toFixed(1)}%</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;

                // Charts
                document.getElementById('hospitaisCharts').innerHTML = `
                    <div class="chart-card" style="grid-column: 1 / -1;">
                        <div class="chart-title">Cobertura por Hospital</div>
                        <div class="chart-wrapper"><canvas id="chartHospitais"></canvas></div>
                    </div>
                `;

                new Chart(document.getElementById('chartHospitais'), {
                    type: 'bar',
                    data: {
                        labels: hospsData.map(h => h.hospital || h.nome || h.nome_hospital || 'N/A'),
                        datasets: [{
                            label: 'Benefici√°rios',
                            data: hospsData.map(h => parseInt(h.beneficiarios || 0)),
                            backgroundColor: '#60a5fa',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { 
                                beginAtZero: true,
                                ticks: { color: '#94a3b8' },
                                grid: { color: 'rgba(255,255,255,0.05)' }
                            },
                            y: { 
                                ticks: { color: '#94a3b8', font: { size: 11 } },
                                grid: { display: false }
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Hospitais renderizados com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao renderizar hospitais:', error);
                console.error('Stack:', error.stack);
            }
        }

        // ==========================================
        // GAPS COM LOGS
        // ==========================================
        function renderizarGaps() {
            console.log('‚ö†Ô∏è RENDERIZANDO GAPS...');
            
            try {
                const { top_20_distantes, distribuicao_por_faixa } = dados.distancias;
                const totalBairros = parseInt(dados.dashboard.kpis_gerais.total_bairros);
                
                console.log('Gaps - top_20_distantes:', top_20_distantes);
                console.log('Gaps - primeiro distante:', top_20_distantes ? top_20_distantes[0] : null);
                console.log('Gaps - keys primeiro:', top_20_distantes && top_20_distantes[0] ? Object.keys(top_20_distantes[0]) : []);
                console.log('Gaps - distribuicao_por_faixa:', distribuicao_por_faixa);
                
                // Calcular bairros descobertos
                const bairrosDescobertos = parseInt(distribuicao_por_faixa["15-20km"]?.bairros || 0) + parseInt(distribuicao_por_faixa[">20km"]?.bairros || 0);
                const benef15_20 = parseInt(distribuicao_por_faixa["15-20km"]?.beneficiarios || 0);
                const benefMais20 = parseInt(distribuicao_por_faixa[">20km"]?.beneficiarios || 0);
                const benefDescobertos = benef15_20 + benefMais20;
                
                // Stats
                document.getElementById('gapsStats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-label">‚ö†Ô∏è Bairros Descobertos</div>
                        <div class="stat-value">${bairrosDescobertos}</div>
                        <div class="stat-subtitle">${((bairrosDescobertos/totalBairros)*100).toFixed(1)}% (>15km)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üë• Benef. Afetados</div>
                        <div class="stat-value">${benefDescobertos.toLocaleString('pt-BR')}</div>
                        <div class="stat-subtitle">${((benefDescobertos/parseInt(dados.dashboard.kpis_gerais.total_beneficiarios))*100).toFixed(1)}%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üìè Dist√¢ncia M√°xima</div>
                        <div class="stat-value">${parseFloat(top_20_distantes[0]?.distancia_km || 0).toFixed(2)} km</div>
                        <div class="stat-subtitle">${top_20_distantes[0]?.bairro || 'N/A'}</div>
                    </div>
                `;

                // Tabela - COM VALIDA√á√ÉO
                document.getElementById('gapsTabela').innerHTML = `
                    <h3 style="color: #60a5fa; margin-bottom: 20px;">üî¥ Top 20 Bairros Mais Distantes</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Bairro</th>
                                <th>Zona</th>
                                <th>Benef.</th>
                                <th>Hospital</th>
                                <th>Dist√¢ncia</th>
                                <th>Tempo</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${top_20_distantes.map((b, i) => {
                                console.log(`Distante ${i+1}:`, b);
                                const nomeHosp = b.hospital || b.nome_hospital || b.hospital_mais_proximo || 'N/A';
                                const distKm = parseFloat(b.distancia_km || b.distancia || b.distancia_linha_reta_km || 0);
                                const tempoMin = parseInt(b.tempo_min || b.tempo || b.tempo_minutos || 0);
                                
                                return `
                                    <tr>
                                        <td>${i + 1}</td>
                                        <td>${b.bairro || 'N/A'}</td>
                                        <td><span class="zona-badge zona-${normalizeZona(b.zona || '')}">${b.zona || 'N/A'}</span></td>
                                        <td>${parseInt(b.beneficiarios || 0)}</td>
                                        <td>${nomeHosp}</td>
                                        <td>${distKm.toFixed(2)} km</td>
                                        <td>${tempoMin} min</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
                
                console.log('‚úÖ Gaps renderizados com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao renderizar gaps:', error);
                console.error('Stack:', error.stack);
            }
        }

        // MAPA
        function renderizarMapa() {
            if (mapInstance) return;
            
            console.log('üó∫Ô∏è RENDERIZANDO MAPA...');
            
            mapInstance = L.map('mapReal').setView([-23.5505, -46.6333], 10);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap'
            }).addTo(mapInstance);
            
            const hospitalIcon = L.divIcon({
                html: '<div style="background:#ef4444; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:18px; border:3px solid white; box-shadow:0 3px 10px rgba(0,0,0,0.5);">üè•</div>',
                className: '',
                iconSize: [32, 32]
            });
            
            const coordsHospitais = {
                'Hospital Cruz Azul': { lat: -23.565920, lng: -46.622154 },
                'Hospital Adventista': { lat: -23.563566, lng: -46.633928 },
                'S√£o Camilo Ipiranga': { lat: -23.583081, lng: -46.612073 },
                'Santa Clara': { lat: -23.532691, lng: -46.527272 },
                'Santa Virg√≠nia': { lat: -23.536880, lng: -46.589506 },
                'Santa Marcelina': { lat: -23.555054, lng: -46.462603 },
                'S√£o Camilo Pomp√©ia': { lat: -23.534065, lng: -46.688244 },
                'S√£o Camilo Santana': { lat: -23.487767, lng: -46.627247 },
                'Neomater': { lat: -23.669184, lng: -46.553716 }
            };
            
            dados.hospitais.hospitais.forEach(h => {
                const nomeHosp = h.hospital || h.nome || h.nome_hospital;
                const coords = coordsHospitais[nomeHosp];
                if (coords) {
                    L.marker([coords.lat, coords.lng], { icon: hospitalIcon })
                        .bindPopup(`<div style="font-family:sans-serif;"><strong style="color:#60a5fa;font-size:16px;">üè• ${nomeHosp}</strong><br><br><strong>Zona:</strong> ${h.zona || 'N/A'}<br><strong>Benefici√°rios:</strong> ${(h.beneficiarios || 0).toLocaleString('pt-BR')}<br><strong>% Rede:</strong> ${(h.percentual_rede || 0)}%</div>`)
                        .addTo(mapInstance);
                }
            });
            
            console.log('‚úÖ Mapa renderizado com sucesso');
        }

        // NAVEGA√á√ÉO
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            if (sectionId === 'mapa' && !mapInstance) {
                setTimeout(renderizarMapa, 100);
            }
        }

        // UTILIT√ÅRIOS
        function normalizeZona(zona) {
            return zona.toLowerCase()
                .replace(/\s+/g, '-')
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '');
        }

        function getZonaColor(zona) {
            const colors = {
                'Centro': '#6366f1',
                'Centro-Sul': '#10b981',
                'Leste': '#3b82f6',
                'Norte': '#f59e0b',
                'Oeste': '#8b5cf6',
                'ABC': '#ec4899'
            };
            return colors[zona] || '#60a5fa';
        }

        // INICIALIZAR
        window.addEventListener('DOMContentLoaded', () => {
            console.log('\n' + '='.repeat(80));
            console.log('üöÄ PORTAL RAPS - INICIANDO...');
            console.log('='.repeat(80) + '\n');
            carregarDados();
        });
    </script>
</body>
</html>
