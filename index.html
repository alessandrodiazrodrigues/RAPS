<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal RAPS - Prevent Senior | Dashboard v6.0</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Leaflet (Mapa) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ==================== HEADER ==================== */
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #2d3748;
            font-size: 32px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .version {
            background: #48bb78;
            color: white;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        /* ==================== NAVEGA√á√ÉO ==================== */
        .nav {
            background: white;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: #f7fafc;
            color: #4a5568;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            background: #edf2f7;
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* ==================== CONTE√öDO ==================== */
        .content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px;
            min-height: 600px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 28px;
            color: #2d3748;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ==================== KPI CARDS ==================== */
        .kpis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            position: relative;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .kpi-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .kpi-subtitle {
            font-size: 13px;
            opacity: 0.8;
        }

        /* ==================== TOOLTIP ==================== */
        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            font-size: 12px;
            cursor: help;
            position: relative;
        }

        .tooltip-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #2d3748;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            white-space: normal;
            width: 280px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            margin-bottom: 8px;
            line-height: 1.4;
            font-weight: normal;
        }

        .tooltip-icon:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #2d3748;
            margin-bottom: 2px;
        }

        /* ==================== GR√ÅFICOS ==================== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-container {
            background: #f7fafc;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-canvas {
            position: relative;
            height: 350px;
        }

        /* ==================== TABELAS ==================== */
        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-title {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .table-filters {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-input {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            min-width: 200px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            min-width: 150px;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        tbody tr:hover {
            background: #f7fafc;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .zona-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .zona-centro-sul { background: #c3dafe; color: #2c5282; }
        .zona-leste { background: #c6f6d5; color: #276749; }
        .zona-norte { background: #fed7d7; color: #9b2c2c; }
        .zona-oeste { background: #feebc8; color: #9c4221; }
        .zona-abc { background: #e9d8fd; color: #553c9a; }

        /* ==================== ZONA CARDS ==================== */
        .zonas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .zona-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .zona-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }

        .zona-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .zona-card-title {
            font-size: 22px;
            font-weight: 700;
            color: #2d3748;
        }

        .zona-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .zona-stat {
            background: #f7fafc;
            padding: 12px;
            border-radius: 8px;
        }

        .zona-stat-label {
            font-size: 12px;
            color: #718096;
            margin-bottom: 5px;
        }

        .zona-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #2d3748;
        }

        .zona-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .zona-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 12px;
        }

        .faixa-etaria-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 13px;
        }

        .faixa-etaria-label {
            color: #4a5568;
        }

        .faixa-etaria-value {
            font-weight: 600;
            color: #2d3748;
        }

        .programa-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f7fafc;
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .programa-nome {
            color: #4a5568;
            font-weight: 500;
        }

        .programa-total {
            font-weight: 700;
            color: #667eea;
        }

        /* ==================== MAPA ==================== */
        .map-container {
            height: 600px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        /* ==================== LOADING ==================== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px;
            color: #667eea;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ==================== ALERTAS ==================== */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-warning {
            background: #fef5e7;
            border-left: 4px solid #f39c12;
            color: #9c4221;
        }

        .alert-info {
            background: #ebf8ff;
            border-left: 4px solid #3182ce;
            color: #2c5282;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .header h1 {
                font-size: 24px;
            }

            .nav {
                flex-direction: column;
            }

            .nav-tab {
                width: 100%;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .zonas-grid {
                grid-template-columns: 1fr;
            }

            .kpis {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ==================== HEADER ==================== -->
        <div class="header">
            <h1>
                üè• Portal RAPS - Prevent Senior
                <span class="version">v6.0</span>
            </h1>
            <div>
                <span class="badge" id="badge-status">‚è≥ Carregando...</span>
            </div>
        </div>

        <!-- ==================== NAVEGA√á√ÉO ==================== -->
        <div class="nav">
            <button class="nav-tab active" data-section="dashboard">üìä Dashboard</button>
            <button class="nav-tab" data-section="demografia">üë• Demografia</button>
            <button class="nav-tab" data-section="programas">üìã Programas</button>
            <button class="nav-tab" data-section="planos">üí≥ Planos</button>
            <button class="nav-tab" data-section="zonas">üó∫Ô∏è Zonas</button>
            <button class="nav-tab" data-section="hospitais">üè• Hospitais</button>
            <button class="nav-tab" data-section="perifericos">üìç Bairros Perif√©ricos</button>
        </div>

        <!-- ==================== CONTE√öDO ==================== -->
        <div class="content">
            <!-- ==================== LOADING ==================== -->
            <div id="loading" class="loading">
                <div class="loading-spinner"></div>
                <h2>Carregando dados...</h2>
                <p>Aguarde enquanto processamos 412.651 benefici√°rios</p>
            </div>

            <!-- ==================== 1. DASHBOARD ==================== -->
            <div id="dashboard" class="section">
                <h2 class="section-title">üìä Dashboard Executivo</h2>
                
                <div class="kpis" id="dashboard-kpis"></div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">
                            üìè Distribui√ß√£o por Faixas de Dist√¢ncia
                            <span class="tooltip-icon" data-tooltip="Mostra quantos bairros est√£o em cada faixa de dist√¢ncia do hospital mais pr√≥ximo. Dist√¢ncias calculadas usando rotas reais de carro via Google Maps API.">‚ÑπÔ∏è</span>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="chartFaixas"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">
                            üèòÔ∏è Top 15 Bairros
                            <span class="tooltip-icon" data-tooltip="Bairros com maior n√∫mero de benefici√°rios ativos. Essencial para prioriza√ß√£o de recursos e estrat√©gias de atendimento regional.">‚ÑπÔ∏è</span>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="chartTopBairros"></canvas>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">
                            üèÜ Top 15 Bairros - Detalhamento
                            <span class="tooltip-icon" data-tooltip="Lista completa dos 15 bairros com mais benefici√°rios, incluindo hospital mais pr√≥ximo e dist√¢ncia real de deslocamento.">‚ÑπÔ∏è</span>
                        </div>
                    </div>
                    <div id="tableTopBairros"></div>
                </div>
            </div>

            <!-- ==================== 2. DEMOGRAFIA ==================== -->
            <div id="demografia" class="section">
                <h2 class="section-title">üë• An√°lise Demogr√°fica</h2>
                
                <div class="kpis" id="demografia-kpis"></div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">
                            üìä Distribui√ß√£o por Faixas Et√°rias (Perfil 80-)
                            <span class="tooltip-icon" data-tooltip="Benefici√°rios com menos de 80 anos, divididos em 4 faixas et√°rias para an√°lise de perfil de risco e necessidades de cuidado.">‚ÑπÔ∏è</span>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="chartFaixas80menos"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">
                            üìä Distribui√ß√£o por Faixas Et√°rias (Perfil 80+)
                            <span class="tooltip-icon" data-tooltip="Benefici√°rios com 80 anos ou mais, divididos em 4 faixas et√°rias. Grupo que requer aten√ß√£o especial e programas de geriatria.">‚ÑπÔ∏è</span>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="chartFaixas80mais"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== 3. PROGRAMAS ==================== -->
            <div id="programas" class="section">
                <h2 class="section-title">üìã An√°lise de Programas de Sa√∫de</h2>
                
                <div class="alert alert-info">
                    ‚ÑπÔ∏è <strong>Importante:</strong> Um benefici√°rio pode estar em m√∫ltiplos programas simultaneamente. Os percentuais somam mais de 100%.
                </div>
                
                <div class="kpis" id="programas-kpis"></div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">
                            üèÜ Top 10 Programas Mais Procurados
                            <span class="tooltip-icon" data-tooltip="Programas de sa√∫de com maior ades√£o. √ötil para aloca√ß√£o de recursos e identifica√ß√£o de demandas priorit√°rias.">‚ÑπÔ∏è</span>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="chartTopProgramas"></canvas>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">
                            üìã Todos os Programas (26 categorias)
                            <span class="tooltip-icon" data-tooltip="Lista completa de todos os programas de sa√∫de dispon√≠veis na rede, ordenados por n√∫mero de benefici√°rios.">‚ÑπÔ∏è</span>
                        </div>
                    </div>
                    <div id="tableProgramas"></div>
                </div>
            </div>

            <!-- ==================== 4. PLANOS ==================== -->
            <div id="planos" class="section">
                <h2 class="section-title">üí≥ An√°lise de Planos de Sa√∫de</h2>
                
                <div class="kpis" id="planos-kpis"></div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">
                            üèÜ Top 10 Planos Mais Contratados
                            <span class="tooltip-icon" data-tooltip="Planos de sa√∫de com maior n√∫mero de benefici√°rios ativos. An√°lise essencial para estrat√©gias comerciais e de renova√ß√£o.">‚ÑπÔ∏è</span>
                        </div>
                        <div class="chart-canvas">
                            <canvas id="chartTopPlanos"></canvas>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">
                            üìã Todos os Planos (61 tipos)
                            <span class="tooltip-icon" data-tooltip="Lista completa de todos os tipos de planos de sa√∫de contratados pelos benefici√°rios, incluindo acomoda√ß√£o e n√≠vel de cobertura.">‚ÑπÔ∏è</span>
                        </div>
                        <div class="table-filters">
                            <input type="text" id="filterPlanos" class="filter-input" placeholder="üîç Buscar plano...">
                        </div>
                    </div>
                    <div id="tablePlanos"></div>
                </div>
            </div>

            <!-- ==================== 5. ZONAS ==================== -->
            <div id="zonas" class="section">
                <h2 class="section-title">üó∫Ô∏è An√°lise por Zona Geogr√°fica</h2>
                
                <div class="alert alert-info">
                    ‚ÑπÔ∏è <strong>Atualiza√ß√£o:</strong> A zona Centro foi consolidada em Centro-Sul. Agora trabalhamos com 5 zonas principais.
                </div>
                
                <div id="zonas-grid" class="zonas-grid"></div>
            </div>

            <!-- ==================== 6. HOSPITAIS ==================== -->
            <div id="hospitais" class="section">
                <h2 class="section-title">üè• An√°lise por Hospital</h2>
                
                <div class="kpis" id="hospitais-kpis"></div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">
                            üè• Ranking de Hospitais por Cobertura
                            <span class="tooltip-icon" data-tooltip="Hospitais ordenados por n√∫mero de bairros cobertos (onde s√£o o hospital mais pr√≥ximo) e benefici√°rios atendidos.">‚ÑπÔ∏è</span>
                        </div>
                    </div>
                    <div id="tableHospitais"></div>
                </div>
            </div>

            <!-- ==================== 7. BAIRROS PERIF√âRICOS ==================== -->
            <div id="perifericos" class="section">
                <h2 class="section-title">üìç An√°lise de Bairros Perif√©ricos</h2>
                
                <div class="alert alert-warning">
                    ‚ö†Ô∏è <strong>Crit√©rio:</strong> Bairros com mais de 20km de dist√¢ncia do hospital credenciado mais pr√≥ximo (rota real de carro).
                </div>
                
                <div class="kpis" id="perifericos-kpis"></div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">
                            üî¥ Top 10 Bairros Mais Distantes
                            <span class="tooltip-icon" data-tooltip="Bairros com maior dist√¢ncia do hospital mais pr√≥ximo. Cr√≠tico para identificar gaps de cobertura e avaliar necessidade de parcerias regionais ou solu√ß√µes de transporte.">‚ÑπÔ∏è</span>
                        </div>
                        <div class="table-filters">
                            <input type="text" id="filterTop10" class="filter-input" placeholder="üîç Buscar bairro...">
                            <select id="sortTop10" class="filter-select">
                                <option value="distancia">Ordenar por: Dist√¢ncia</option>
                                <option value="beneficiarios">Ordenar por: Benefici√°rios</option>
                                <option value="bairro">Ordenar por: Bairro (A-Z)</option>
                            </select>
                        </div>
                    </div>
                    <div id="tableTop10Distantes"></div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">
                            üìã Todos os Bairros Perif√©ricos
                            <span class="tooltip-icon" data-tooltip="Lista completa de bairros com dist√¢ncia superior a 20km, incluindo os 3 hospitais mais pr√≥ximos de cada um. √ötil para planejamento de expans√£o e solu√ß√µes log√≠sticas.">‚ÑπÔ∏è</span>
                        </div>
                        <div class="table-filters">
                            <input type="text" id="filterTodos" class="filter-input" placeholder="üîç Buscar bairro...">
                            <select id="filterZona" class="filter-select">
                                <option value="">Todas as zonas</option>
                                <option value="Centro-Sul">Centro-Sul</option>
                                <option value="Leste">Leste</option>
                                <option value="Norte">Norte</option>
                                <option value="Oeste">Oeste</option>
                                <option value="ABC">ABC</option>
                            </select>
                        </div>
                    </div>
                    <div id="tableTodosPerifricos"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== CONFIGURA√á√ÉO ==================== 
        const GITHUB_USER = 'alessandrodiazrodrigues';
        const REPO = 'RAPS';
        const BRANCH = 'main';
        const DATA_URL = `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/${BRANCH}/data`;

        // Vari√°veis globais
        let dados = {};
        let charts = {};

        // ==================== CARREGAR DADOS ====================
        async function carregarDados() {
            try {
                console.log('üîÑ Carregando dados...');

                const [dashboard, demografico, programas, planos, zonas, hospitais, distancias, perifericos] = await Promise.all([
                    fetch(`${DATA_URL}/dashboard.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/demografico.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/programas.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/planos.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/zonas.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/hospitais.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/distancias.json`).then(r => r.json()),
                    fetch(`${DATA_URL}/bairros_perifericos.json`).then(r => r.json())
                ]);

                dados = { dashboard, demografico, programas, planos, zonas, hospitais, distancias, perifericos };

                console.log('‚úÖ Dados carregados:', dados);

                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                document.getElementById('badge-status').textContent = '‚úÖ DADOS REAIS';
                document.getElementById('badge-status').style.background = 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)';

                renderizarTudo();

            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="loading-spinner"></div>
                    <h2 style="color: #e53e3e;">Erro ao carregar dados</h2>
                    <p>${error.message}</p>
                `;
            }
        }

        // ==================== RENDERIZAR TUDO ====================
        function renderizarTudo() {
            renderizarDashboard();
            renderizarDemografia();
            renderizarProgramas();
            renderizarPlanos();
            renderizarZonas();
            renderizarHospitais();
            renderizarPerifericos();
        }

        // ==================== 1. DASHBOARD ====================
        function renderizarDashboard() {
            const { kpis_gerais, distribuicao_faixas, top_bairros, bairros_descobertos } = dados.dashboard;

            // KPIs
            const kpisHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">
                        üë• Total de Benefici√°rios
                        <span class="tooltip-icon" data-tooltip="N√∫mero total de pessoas ativas no plano de sa√∫de Prevent Senior, distribu√≠das em 5 regi√µes da Grande S√£o Paulo. Inclui todos os tipos de planos e categorias de atendimento.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis_gerais.total_beneficiarios.toLocaleString('pt-BR')}</div>
                    <div class="kpi-subtitle">em 5 zonas</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üèòÔ∏è Total de Bairros
                        <span class="tooltip-icon" data-tooltip="N√∫mero total de bairros √∫nicos onde temos benefici√°rios ativos na rede. Os nomes foram normalizados para evitar duplicatas (Centro consolidado em Centro-Sul).">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis_gerais.total_bairros.toLocaleString('pt-BR')}</div>
                    <div class="kpi-subtitle">normalizados</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üè• Total de Hospitais
                        <span class="tooltip-icon" data-tooltip="N√∫mero de hospitais credenciados na rede Prevent Senior, estrategicamente distribu√≠dos nas 5 zonas para garantir cobertura adequada.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis_gerais.total_hospitais}</div>
                    <div class="kpi-subtitle">credenciados</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üìè Dist√¢ncia M√©dia
                        <span class="tooltip-icon" data-tooltip="Dist√¢ncia m√©dia real (rota de carro) de todos os benefici√°rios at√© o hospital mais pr√≥ximo. Calculado usando Google Maps Directions API.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis_gerais.distancia_media_km} km</div>
                    <div class="kpi-subtitle">at√© hospital mais pr√≥ximo</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        ‚úÖ Cobertura 15km
                        <span class="tooltip-icon" data-tooltip="Percentual de benefici√°rios que est√£o a at√© 15km do hospital mais pr√≥ximo. Meta interna: m√≠nimo 85% de cobertura.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis_gerais.cobertura_15km_pct}%</div>
                    <div class="kpi-subtitle">${bairros_descobertos ? bairros_descobertos.total_beneficiarios.toLocaleString('pt-BR') : '0'} fora da cobertura</div>
                </div>
            `;

            document.getElementById('dashboard-kpis').innerHTML = kpisHTML;

            // Gr√°fico: Distribui√ß√£o por Faixas
            const ctxFaixas = document.getElementById('chartFaixas').getContext('2d');
            if (charts.faixas) charts.faixas.destroy();
            charts.faixas = new Chart(ctxFaixas, {
                type: 'bar',
                data: {
                    labels: Object.keys(distribuicao_faixas),
                    datasets: [{
                        label: 'N√∫mero de Bairros',
                        data: Object.values(distribuicao_faixas),
                        backgroundColor: [
                            '#48bb78',
                            '#4299e1',
                            '#ed8936',
                            '#f56565',
                            '#9f7aea',
                            '#ed64a6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Gr√°fico: Top 15 Bairros
            const ctxTopBairros = document.getElementById('chartTopBairros').getContext('2d');
            if (charts.topBairros) charts.topBairros.destroy();
            charts.topBairros = new Chart(ctxTopBairros, {
                type: 'bar',
                data: {
                    labels: top_bairros.map(b => b.bairro),
                    datasets: [{
                        label: 'Benefici√°rios',
                        data: top_bairros.map(b => b.beneficiarios),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { beginAtZero: true }
                    }
                }
            });

            // Tabela: Top 15 Bairros
            const tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Bairro</th>
                            <th>Zona</th>
                            <th>Benefici√°rios</th>
                            <th>Hospital Mais Pr√≥ximo</th>
                            <th>Dist√¢ncia</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${top_bairros.map((b, i) => `
                            <tr>
                                <td><strong>${i + 1}</strong></td>
                                <td>${b.bairro}</td>
                                <td><span class="zona-badge zona-${b.zona.toLowerCase().replace(' ', '-').replace('-sul', '-sul')}">${b.zona}</span></td>
                                <td><strong>${b.beneficiarios.toLocaleString('pt-BR')}</strong></td>
                                <td>${b.hospital_proximo}</td>
                                <td>${b.distancia_km} km</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('tableTopBairros').innerHTML = tableHTML;
        }

        // ==================== 2. DEMOGRAFIA ====================
        function renderizarDemografia() {
            const { kpis, faixas_etarias } = dados.demografico;

            // KPIs
            const kpisHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">
                        üìä Idade M√©dia (18+)
                        <span class="tooltip-icon" data-tooltip="Idade m√©dia dos benefici√°rios adultos (18 anos ou mais). Importante para planejamento de programas de sa√∫de e perfil de risco.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis.idade_media_adultos_18plus}</div>
                    <div class="kpi-subtitle">anos</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üë© Feminino
                        <span class="tooltip-icon" data-tooltip="Percentual de benefici√°rias do sexo feminino na rede. Mulheres geralmente t√™m maior utiliza√ß√£o de servi√ßos de sa√∫de preventivos.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis.pct_feminino}%</div>
                    <div class="kpi-subtitle">${Math.round(dados.dashboard.kpis_gerais.total_beneficiarios * parseFloat(kpis.pct_feminino) / 100).toLocaleString('pt-BR')} benefici√°rias</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üë® Masculino
                        <span class="tooltip-icon" data-tooltip="Percentual de benefici√°rios do sexo masculino na rede. Homens geralmente t√™m menor ades√£o a programas preventivos.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis.pct_masculino}%</div>
                    <div class="kpi-subtitle">${Math.round(dados.dashboard.kpis_gerais.total_beneficiarios * parseFloat(kpis.pct_masculino) / 100).toLocaleString('pt-BR')} benefici√°rios</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üë¥ Idosos 75+
                        <span class="tooltip-icon" data-tooltip="Total de benefici√°rios com 75 anos ou mais. Grupo priorit√°rio para programas de geriatria e cuidados preventivos.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis.total_idosos_75plus.toLocaleString('pt-BR')}</div>
                    <div class="kpi-subtitle">${((kpis.total_idosos_75plus / dados.dashboard.kpis_gerais.total_beneficiarios) * 100).toFixed(1)}% do total</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üè• Idosos 80+
                        <span class="tooltip-icon" data-tooltip="Total de benefici√°rios com 80 anos ou mais. Grupo que requer aten√ß√£o especializada e acompanhamento geri√°trico cont√≠nuo.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis.total_idosos_80plus.toLocaleString('pt-BR')}</div>
                    <div class="kpi-subtitle">${((kpis.total_idosos_80plus / dados.dashboard.kpis_gerais.total_beneficiarios) * 100).toFixed(1)}% do total</div>
                </div>
            `;

            document.getElementById('demografia-kpis').innerHTML = kpisHTML;

            // Gr√°fico: Faixas 80-
            const ctx80menos = document.getElementById('chartFaixas80menos').getContext('2d');
            if (charts.faixas80menos) charts.faixas80menos.destroy();
            charts.faixas80menos = new Chart(ctx80menos, {
                type: 'doughnut',
                data: {
                    labels: ['18-49 anos', '50-69 anos', '70-74 anos', '75-79 anos'],
                    datasets: [{
                        data: [
                            faixas_etarias.perfil_80_menos.faixas['18_a_49'],
                            faixas_etarias.perfil_80_menos.faixas['50_a_69'],
                            faixas_etarias.perfil_80_menos.faixas['70_a_74'],
                            faixas_etarias.perfil_80_menos.faixas['75_a_79']
                        ],
                        backgroundColor: ['#48bb78', '#4299e1', '#ed8936', '#f56565']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Gr√°fico: Faixas 80+
            const ctx80mais = document.getElementById('chartFaixas80mais').getContext('2d');
            if (charts.faixas80mais) charts.faixas80mais.destroy();
            charts.faixas80mais = new Chart(ctx80mais, {
                type: 'doughnut',
                data: {
                    labels: ['80-89 anos', '90-94 anos', '95-99 anos', '100+ anos'],
                    datasets: [{
                        data: [
                            faixas_etarias.perfil_80_mais.faixas['80_a_89'],
                            faixas_etarias.perfil_80_mais.faixas['90_a_94'],
                            faixas_etarias.perfil_80_mais.faixas['95_a_99'],
                            faixas_etarias.perfil_80_mais.faixas['100_ou_mais']
                        ],
                        backgroundColor: ['#9f7aea', '#ed64a6', '#fc8181', '#f687b3']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // ==================== 3. PROGRAMAS ====================
        function renderizarProgramas() {
            const { programas, top_10 } = dados.programas;

            // KPIs
            const totalProgramas = programas.length;
            const semPrograma = programas.find(p => p.nome === 'SEM PROGRAMA');
            const comPrograma = dados.dashboard.kpis_gerais.total_beneficiarios - (semPrograma ? semPrograma.total : 0);

            const kpisHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">
                        üìä Total de Programas
                        <span class="tooltip-icon" data-tooltip="Total de categorias de programas de sa√∫de dispon√≠veis na rede Prevent Senior.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${totalProgramas}</div>
                    <div class="kpi-subtitle">categorias ativas</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        ‚ùå Sem Programa
                        <span class="tooltip-icon" data-tooltip="Benefici√°rios que n√£o est√£o inscritos em nenhum programa de sa√∫de espec√≠fico. Oportunidade para capta√ß√£o e engajamento.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${semPrograma ? semPrograma.total.toLocaleString('pt-BR') : '0'}</div>
                    <div class="kpi-subtitle">${semPrograma ? semPrograma.percentual : '0'}% do total</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        ‚úÖ Com Programa
                        <span class="tooltip-icon" data-tooltip="Benefici√°rios inscritos em pelo menos um programa de sa√∫de. Um benefici√°rio pode estar em m√∫ltiplos programas simultaneamente.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${comPrograma.toLocaleString('pt-BR')}</div>
                    <div class="kpi-subtitle">${((comPrograma / dados.dashboard.kpis_gerais.total_beneficiarios) * 100).toFixed(1)}% do total</div>
                </div>
            `;

            document.getElementById('programas-kpis').innerHTML = kpisHTML;

            // Gr√°fico: Top 10
            const ctxTopProgramas = document.getElementById('chartTopProgramas').getContext('2d');
            if (charts.topProgramas) charts.topProgramas.destroy();
            charts.topProgramas = new Chart(ctxTopProgramas, {
                type: 'bar',
                data: {
                    labels: top_10.map(p => p.nome),
                    datasets: [{
                        label: 'Benefici√°rios',
                        data: top_10.map(p => p.total),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { beginAtZero: true }
                    }
                }
            });

            // Tabela: Todos os programas
            const tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Programa</th>
                            <th>Benefici√°rios</th>
                            <th>Percentual</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${programas.map((p, i) => `
                            <tr>
                                <td>${i + 1}</td>
                                <td><strong>${p.nome}</strong></td>
                                <td>${p.total.toLocaleString('pt-BR')}</td>
                                <td>${p.percentual}%</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('tableProgramas').innerHTML = tableHTML;
        }

        // ==================== 4. PLANOS ====================
        function renderizarPlanos() {
            const { kpis, todos_planos, top_10_geral } = dados.planos;

            // KPIs
            const kpisHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">
                        üìã Total de Planos
                        <span class="tooltip-icon" data-tooltip="Total de tipos diferentes de planos de sa√∫de contratados pelos benefici√°rios.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis.total_planos_unicos}</div>
                    <div class="kpi-subtitle">tipos diferentes</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üèÜ Plano Mais Comum
                        <span class="tooltip-icon" data-tooltip="Plano de sa√∫de com maior n√∫mero de benefici√°rios ativos na rede.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis.plano_mais_comum}</div>
                    <div class="kpi-subtitle">${kpis.pct_plano_mais_comum}% dos benefici√°rios</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üë• Top 5 Planos
                        <span class="tooltip-icon" data-tooltip="Total de benefici√°rios concentrados nos 5 planos mais comuns. Indica n√≠vel de concentra√ß√£o da carteira.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${kpis.total_top_5.toLocaleString('pt-BR')}</div>
                    <div class="kpi-subtitle">${((kpis.total_top_5 / kpis.total_beneficiarios) * 100).toFixed(1)}% do total</div>
                </div>
            `;

            document.getElementById('planos-kpis').innerHTML = kpisHTML;

            // Gr√°fico: Top 10
            const ctxTopPlanos = document.getElementById('chartTopPlanos').getContext('2d');
            if (charts.topPlanos) charts.topPlanos.destroy();
            charts.topPlanos = new Chart(ctxTopPlanos, {
                type: 'bar',
                data: {
                    labels: top_10_geral.map(p => p.nome),
                    datasets: [{
                        label: 'Benefici√°rios',
                        data: top_10_geral.map(p => p.total),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { beginAtZero: true }
                    }
                }
            });

            // Tabela: Todos os planos (com filtro)
            renderizarTabelaPlanos(todos_planos);

            // Event listener para filtro
            document.getElementById('filterPlanos').addEventListener('input', (e) => {
                const termo = e.target.value.toLowerCase();
                const filtrados = todos_planos.filter(p => p.nome.toLowerCase().includes(termo));
                renderizarTabelaPlanos(filtrados);
            });
        }

        function renderizarTabelaPlanos(planos) {
            const tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Plano</th>
                            <th>Benefici√°rios</th>
                            <th>Percentual</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${planos.map((p, i) => `
                            <tr>
                                <td>${i + 1}</td>
                                <td><strong>${p.nome}</strong></td>
                                <td>${p.total.toLocaleString('pt-BR')}</td>
                                <td>${p.percentual}%</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('tablePlanos').innerHTML = tableHTML;
        }

        // ==================== 5. ZONAS ====================
        function renderizarZonas() {
            const { zonas } = dados.zonas;

            const zonasHTML = zonas.map(zona => {
                const faixas = zona.faixas_etarias;
                const programas = zona.top_programas;

                return `
                    <div class="zona-card">
                        <div class="zona-card-header">
                            <h3 class="zona-card-title">üìç ${zona.nome}</h3>
                            <span class="zona-badge zona-${zona.nome.toLowerCase().replace(' ', '-')}">${zona.beneficiarios.toLocaleString('pt-BR')}</span>
                        </div>

                        <div class="zona-stats">
                            <div class="zona-stat">
                                <div class="zona-stat-label">Bairros</div>
                                <div class="zona-stat-value">${zona.bairros}</div>
                            </div>
                            <div class="zona-stat">
                                <div class="zona-stat-label">Idade M√©dia</div>
                                <div class="zona-stat-value">${zona.idade_media_adultos} anos</div>
                            </div>
                            <div class="zona-stat">
                                <div class="zona-stat-label">Feminino</div>
                                <div class="zona-stat-value">${zona.pct_feminino}%</div>
                            </div>
                            <div class="zona-stat">
                                <div class="zona-stat-label">Masculino</div>
                                <div class="zona-stat-value">${zona.pct_masculino}%</div>
                            </div>
                            <div class="zona-stat">
                                <div class="zona-stat-label">Idosos 80+</div>
                                <div class="zona-stat-value">${zona.idosos_80plus.toLocaleString('pt-BR')}</div>
                            </div>
                            <div class="zona-stat">
                                <div class="zona-stat-label">Dist. M√©dia</div>
                                <div class="zona-stat-value">${zona.distancia_media_km} km</div>
                            </div>
                        </div>

                        <div class="zona-section">
                            <div class="zona-section-title">
                                üë• Distribui√ß√£o Et√°ria (8 faixas)
                                <span class="tooltip-icon" data-tooltip="Divis√£o dos benefici√°rios da zona em 8 faixas et√°rias para an√°lise detalhada de perfil demogr√°fico.">‚ÑπÔ∏è</span>
                            </div>
                            <div class="faixa-etaria-item">
                                <span class="faixa-etaria-label">18-49 anos:</span>
                                <span class="faixa-etaria-value">${faixas['18_a_49'].total.toLocaleString('pt-BR')} (${faixas['18_a_49'].percentual}%)</span>
                            </div>
                            <div class="faixa-etaria-item">
                                <span class="faixa-etaria-label">50-69 anos:</span>
                                <span class="faixa-etaria-value">${faixas['50_a_69'].total.toLocaleString('pt-BR')} (${faixas['50_a_69'].percentual}%)</span>
                            </div>
                            <div class="faixa-etaria-item">
                                <span class="faixa-etaria-label">70-74 anos:</span>
                                <span class="faixa-etaria-value">${faixas['70_a_74'].total.toLocaleString('pt-BR')} (${faixas['70_a_74'].percentual}%)</span>
                            </div>
                            <div class="faixa-etaria-item">
                                <span class="faixa-etaria-label">75-79 anos:</span>
                                <span class="faixa-etaria-value">${faixas['75_a_79'].total.toLocaleString('pt-BR')} (${faixas['75_a_79'].percentual}%)</span>
                            </div>
                            <div class="faixa-etaria-item">
                                <span class="faixa-etaria-label">80-89 anos:</span>
                                <span class="faixa-etaria-value">${faixas['80_a_89'].total.toLocaleString('pt-BR')} (${faixas['80_a_89'].percentual}%)</span>
                            </div>
                            <div class="faixa-etaria-item">
                                <span class="faixa-etaria-label">90-94 anos:</span>
                                <span class="faixa-etaria-value">${faixas['90_a_94'].total.toLocaleString('pt-BR')} (${faixas['90_a_94'].percentual}%)</span>
                            </div>
                            <div class="faixa-etaria-item">
                                <span class="faixa-etaria-label">95-99 anos:</span>
                                <span class="faixa-etaria-value">${faixas['95_a_99'].total.toLocaleString('pt-BR')} (${faixas['95_a_99'].percentual}%)</span>
                            </div>
                            <div class="faixa-etaria-item">
                                <span class="faixa-etaria-label">100+ anos:</span>
                                <span class="faixa-etaria-value">${faixas['100_ou_mais'].total.toLocaleString('pt-BR')} (${faixas['100_ou_mais'].percentual}%)</span>
                            </div>
                        </div>

                        <div class="zona-section">
                            <div class="zona-section-title">
                                üìã Top 4 Programas
                                <span class="tooltip-icon" data-tooltip="Os 4 programas de sa√∫de mais procurados nesta zona, mostrando n√∫mero absoluto de benefici√°rios inscritos.">‚ÑπÔ∏è</span>
                            </div>
                            ${programas.map((p, i) => `
                                <div class="programa-item">
                                    <span class="programa-nome">${i + 1}. ${p.nome}</span>
                                    <span class="programa-total">${p.total.toLocaleString('pt-BR')}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('zonas-grid').innerHTML = zonasHTML;
        }

        // ==================== 6. HOSPITAIS ====================
        function renderizarHospitais() {
            const { hospitais } = dados.hospitais;

            // KPIs
            const totalHospitais = hospitais.length;
            const maiorCobertura = hospitais[0];

            const kpisHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">
                        üè• Total de Hospitais
                        <span class="tooltip-icon" data-tooltip="N√∫mero total de hospitais credenciados na rede Prevent Senior.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${totalHospitais}</div>
                    <div class="kpi-subtitle">na rede credenciada</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üèÜ Maior Cobertura
                        <span class="tooltip-icon" data-tooltip="Hospital com maior n√∫mero de bairros onde √© o hospital mais pr√≥ximo e maior n√∫mero de benefici√°rios atendidos.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${maiorCobertura.nome}</div>
                    <div class="kpi-subtitle">${maiorCobertura.bairros_cobertos} bairros | ${maiorCobertura.beneficiarios.toLocaleString('pt-BR')} benef.</div>
                </div>
            `;

            document.getElementById('hospitais-kpis').innerHTML = kpisHTML;

            // Tabela: Ranking
            const tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Hospital</th>
                            <th>Zona</th>
                            <th>Bairros</th>
                            <th>Benefici√°rios</th>
                            <th>% Rede</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${hospitais.map((h, i) => `
                            <tr>
                                <td><strong>${i + 1}</strong></td>
                                <td><strong>${h.nome}</strong></td>
                                <td><span class="zona-badge zona-${h.zona.toLowerCase().replace(' ', '-')}">${h.zona}</span></td>
                                <td>${h.bairros_cobertos}</td>
                                <td><strong>${h.beneficiarios.toLocaleString('pt-BR')}</strong></td>
                                <td>${h.percentual_rede}%</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('tableHospitais').innerHTML = tableHTML;
        }

        // ==================== 7. BAIRROS PERIF√âRICOS ====================
        function renderizarPerifericos() {
            const { metadata, top_10_mais_distantes, todos_bairros } = dados.perifericos;

            // KPIs
            const kpisHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">
                        üìç Total de Bairros
                        <span class="tooltip-icon" data-tooltip="N√∫mero de bairros com dist√¢ncia superior a 20km do hospital credenciado mais pr√≥ximo.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${metadata.total_bairros}</div>
                    <div class="kpi-subtitle">>20km do hospital</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üë• Benefici√°rios Afetados
                        <span class="tooltip-icon" data-tooltip="Total de benefici√°rios que residem em bairros perif√©ricos (>20km). Representa apenas ${((metadata.total_beneficiarios / 412651) * 100).toFixed(1)}% da rede.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${metadata.total_beneficiarios.toLocaleString('pt-BR')}</div>
                    <div class="kpi-subtitle">${((metadata.total_beneficiarios / 412651) * 100).toFixed(1)}% da rede</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        üìè Dist√¢ncia M√©dia
                        <span class="tooltip-icon" data-tooltip="Dist√¢ncia m√©dia real (rota de carro) dos bairros perif√©ricos at√© o hospital mais pr√≥ximo.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${metadata.distancia_media_km} km</div>
                    <div class="kpi-subtitle">at√© hospital mais pr√≥ximo</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">
                        ‚è±Ô∏è Tempo M√©dio
                        <span class="tooltip-icon" data-tooltip="Tempo m√©dio de deslocamento de carro dos bairros perif√©ricos at√© o hospital mais pr√≥ximo, considerando tr√¢nsito normal.">‚ÑπÔ∏è</span>
                    </div>
                    <div class="kpi-value">${metadata.tempo_medio_min} min</div>
                    <div class="kpi-subtitle">de deslocamento</div>
                </div>
            `;

            document.getElementById('perifericos-kpis').innerHTML = kpisHTML;

            // Tabela: Top 10 (com filtros)
            renderizarTabelaTop10(top_10_mais_distantes);

            // Event listeners para filtros
            document.getElementById('filterTop10').addEventListener('input', (e) => {
                const termo = e.target.value.toLowerCase();
                const filtrados = top_10_mais_distantes.filter(b => b.bairro.toLowerCase().includes(termo));
                renderizarTabelaTop10(filtrados);
            });

            document.getElementById('sortTop10').addEventListener('change', (e) => {
                const criterio = e.target.value;
                let ordenados = [...top_10_mais_distantes];
                
                if (criterio === 'distancia') {
                    ordenados.sort((a, b) => b.distancia_km - a.distancia_km);
                } else if (criterio === 'beneficiarios') {
                    ordenados.sort((a, b) => b.beneficiarios - a.beneficiarios);
                } else if (criterio === 'bairro') {
                    ordenados.sort((a, b) => a.bairro.localeCompare(b.bairro));
                }
                
                renderizarTabelaTop10(ordenados);
            });

            // Tabela: Todos (com filtros)
            renderizarTabelaTodos(todos_bairros);

            // Event listeners para filtros
            document.getElementById('filterTodos').addEventListener('input', (e) => {
                const termo = e.target.value.toLowerCase();
                const zona = document.getElementById('filterZona').value;
                
                let filtrados = todos_bairros.filter(b => b.bairro.toLowerCase().includes(termo));
                if (zona) filtrados = filtrados.filter(b => b.zona === zona);
                
                renderizarTabelaTodos(filtrados);
            });

            document.getElementById('filterZona').addEventListener('change', (e) => {
                const zona = e.target.value;
                const termo = document.getElementById('filterTodos').value.toLowerCase();
                
                let filtrados = todos_bairros.filter(b => b.bairro.toLowerCase().includes(termo));
                if (zona) filtrados = filtrados.filter(b => b.zona === zona);
                
                renderizarTabelaTodos(filtrados);
            });
        }

        function renderizarTabelaTop10(bairros) {
            const tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Bairro</th>
                            <th>Zona</th>
                            <th>Benef.</th>
                            <th>1¬∫ Hospital</th>
                            <th>Dist.</th>
                            <th>2¬∫ Hospital</th>
                            <th>Dist.</th>
                            <th>3¬∫ Hospital</th>
                            <th>Dist.</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${bairros.map((b, i) => `
                            <tr>
                                <td><strong>${i + 1}</strong></td>
                                <td>${b.bairro}</td>
                                <td><span class="zona-badge zona-${b.zona.toLowerCase().replace(' ', '-')}">${b.zona}</span></td>
                                <td>${b.beneficiarios}</td>
                                <td>${b.hospitais_proximos[0].hospital}</td>
                                <td><strong>${b.hospitais_proximos[0].distancia_km} km</strong></td>
                                <td>${b.hospitais_proximos[1].hospital}</td>
                                <td>${b.hospitais_proximos[1].distancia_km} km</td>
                                <td>${b.hospitais_proximos[2].hospital}</td>
                                <td>${b.hospitais_proximos[2].distancia_km} km</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('tableTop10Distantes').innerHTML = tableHTML;
        }

        function renderizarTabelaTodos(bairros) {
            const tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Bairro</th>
                            <th>Zona</th>
                            <th>Benef.</th>
                            <th>Hospital Mais Pr√≥ximo</th>
                            <th>Dist√¢ncia</th>
                            <th>Tempo</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${bairros.map(b => `
                            <tr>
                                <td><strong>${b.bairro}</strong></td>
                                <td><span class="zona-badge zona-${b.zona.toLowerCase().replace(' ', '-')}">${b.zona}</span></td>
                                <td>${b.beneficiarios}</td>
                                <td>${b.hospital_mais_proximo}</td>
                                <td><strong>${b.distancia_km} km</strong></td>
                                <td>${b.tempo_min} min</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('tableTodosPerifricos').innerHTML = tableHTML;
        }

        // ==================== NAVEGA√á√ÉO ====================
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remover active de todos
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                
                // Adicionar active ao clicado
                tab.classList.add('active');
                const sectionId = tab.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
            });
        });

        // ==================== INICIALIZAR ====================
        window.addEventListener('DOMContentLoaded', carregarDados);
    </script>
</body>
</html>
